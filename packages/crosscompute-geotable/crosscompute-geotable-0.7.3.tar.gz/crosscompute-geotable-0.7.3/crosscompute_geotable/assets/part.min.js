function get_geotable_adjective(e){var a="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+a+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,a){for(var t=e+"-map",i=e+"-table",o=L.mapbox.map(t,"mapbox."+get_geotable_adjective(e)),l=[],r=a[0],n=a[1],d=0;d<r.length;d++){var s,c=r[d],p=c[0],u=c[1],_=$.extend({color:"black",weight:2,opacity:.7,fillColor:"yellow",fillOpacity:.5},n,c[2]);switch(p){case 1:s=L.circleMarker(u,_),_.radius_in_pixels&&s.setRadius(+_.radius_in_pixels),add_feature(l,s,d,i);break;case 2:add_feature(l,s=L.polyline(u,_),d,i);break;case 3:for(var g=0;g<u.length;g++)add_feature(l,s=L.polyline(u[g],_),d+"-"+g,i)}}l.length&&o.fitBounds(L.featureGroup(l).addTo(o).getBounds(),{animate:!1}).on("click",function(){$("#"+i).hide()})}function add_feature(e,a,t,i){a.geotable={table_id:i,tbody_id:i.replace("-table","-row")+t},a.on("click",function(e){var a=this.geotable,t=$("#"+a.tbody_id).show();$("#"+a.table_id+" tbody").not(t).hide(),$("#"+a.table_id).show(),L.DomEvent.stopPropagation(e)}),e.push(a)}$(".geotable-upload").on("uploaded.ir",function(e,a){var t=$(this).next(".feedback");t.text("Loading... Large datasets can take a few minutes");var i=$(this).data("name"),o=i,l=$("#"+o);$.post(CC.geotable.import_url,{upload_id:a.upload_id,argument_name:i}).fail(function(e){l.find(".geotable-map").html(e.responseJSON[i])}).success(function(e){l.html(e),$("[name="+o+"]").val(a.upload_id);var t=l.find("script").text(),r=$.trim(t.replace(/'/g,'"').replace(/.* = /,"")).slice(0,-1);draw_map(i,$.parseJSON(r))}).always(function(){t.text("")})});
