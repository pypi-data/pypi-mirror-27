{"version":3,"sources":["reviewRequestPageModelTests.es6.js"],"names":[],"mappings":"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","file":"reviewRequestPageModelTests.js","sourcesContent":["suite('rb/reviewRequestPage/models/ReviewRequestPage', function() {\n    let page;\n\n    beforeEach(function() {\n        page = new RB.ReviewRequestPage.ReviewRequestPage({\n            updatesURL: '/r/123/_updates/',\n            checkForUpdates: false,\n            reviewRequestData: {},\n            editorData: {\n                fileAttachments: [],\n                mutableByUser: true,\n                showSendEmail: false,\n            },\n        }, {\n            parse: true,\n        });\n    });\n\n    describe('Methods', function() {\n        it('addEntry', function() {\n            const entry = new RB.ReviewRequestPage.Entry();\n\n            page.addEntry(entry);\n\n            expect(entry.get('page')).toBe(page);\n            expect(page.entries.at(0)).toBe(entry);\n        });\n\n        describe('parse', function() {\n            it('Parent called', function() {\n                const attrs = page.parse({\n                    reviewRequestData: {\n                        summary: 'Test summary',\n                    },\n                });\n\n                expect(attrs.reviewRequest).toBeTruthy();\n                expect(attrs.reviewRequest.get('summary')).toBe('Test summary');\n            });\n\n            it('updatesURL', function() {\n                const attrs = page.parse({\n                    updatesURL: 'https://example.com/',\n                });\n\n                expect(attrs.updatesURL).toBe('https://example.com/');\n            });\n        });\n\n        describe('watchEntryUpdates', function() {\n            let entry;\n\n            beforeEach(function() {\n                spyOn(page, '_scheduleCheckUpdates');\n\n                entry = new RB.ReviewRequestPage.Entry({\n                    id: 'my-entry',\n                });\n            });\n\n            it('First call', function() {\n                page.watchEntryUpdates(entry, 1000);\n\n                expect(page._watchedUpdatesPeriodMS).toBe(1000);\n                expect(page._watchedEntries[entry.id]).toEqual({\n                    entry: entry,\n                    periodMS: 1000,\n                });\n                expect(page._scheduleCheckUpdates).toHaveBeenCalled();\n            });\n\n            it('Shorter watch periods take precedent', function() {\n                page._watchedUpdatesPeriodMS = 5000;\n                page.watchEntryUpdates(entry, 1000);\n\n                expect(page._watchedUpdatesPeriodMS).toBe(1000);\n                expect(page._watchedEntries[entry.id]).toEqual({\n                    entry: entry,\n                    periodMS: 1000,\n                });\n                expect(page._scheduleCheckUpdates).toHaveBeenCalled();\n            });\n\n            it('Subsequent call with longer watch period', function() {\n                page._watchedUpdatesPeriodMS = 1000;\n                page.watchEntryUpdates(entry, 5000);\n\n                expect(page._watchedUpdatesPeriodMS).toBe(1000);\n                expect(page._watchedEntries[entry.id]).toEqual({\n                    entry: entry,\n                    periodMS: 5000,\n                });\n                expect(page._scheduleCheckUpdates).toHaveBeenCalled();\n            });\n        });\n\n        describe('stopWatchingEntryUpdates', function() {\n            beforeEach(function() {\n                spyOn(page, '_scheduleCheckUpdates');\n            });\n\n            it('Switches to next-shortest update period', function() {\n                const entry1 = new RB.ReviewRequestPage.Entry({\n                    id: '1',\n                });\n\n                const entry2 = new RB.ReviewRequestPage.Entry({\n                    id: '2',\n                });\n\n                page.watchEntryUpdates(entry1, 2000);\n                page.watchEntryUpdates(entry2, 1000);\n                expect(page._watchedUpdatesPeriodMS).toBe(1000);\n\n                page.stopWatchingEntryUpdates(entry2);\n                expect(page._watchedUpdatesPeriodMS).toBe(2000);\n            });\n\n            it('Last entry being watched', function() {\n                const entry = new RB.ReviewRequestPage.Entry({\n                    id: '1',\n                });\n\n                page.watchEntryUpdates(entry, 1000);\n                page.stopWatchingEntryUpdates(entry);\n\n                expect(_.isEmpty(page._watchedEntries)).toBe(true);\n                expect(page._watchedUpdatesTimeout).toBe(null);\n                expect(page._watchedUpdatesPeriodMS).toBe(null);\n                expect(page._watchedUpdatesLastScheduleTime).toBe(null);\n            });\n        });\n    });\n\n    describe('Dynamic updating', function() {\n        it('Scheduled check for update', function() {\n            let scheduledCallback = null;\n\n            spyOn(page, '_scheduleCheckUpdates').and.callThrough();\n            spyOn(window, 'setTimeout').and.callFake((cb, ms) => {\n                scheduledCallback = cb;\n\n                return 'dummy value';\n            });\n            spyOn(page, '_loadUpdates').and.callThrough();\n            spyOn(Backbone, 'sync');\n\n            const entry1 = new RB.ReviewRequestPage.Entry({\n                typeID: 'my-entry',\n                id: '100',\n            });\n\n            const entry2 = new RB.ReviewRequestPage.Entry({\n                typeID: 'my-entry',\n                id: '200',\n            });\n\n            const entry3 = new RB.ReviewRequestPage.Entry({\n                typeID: 'another-entry',\n                id: 'foo',\n            });\n\n            page.watchEntryUpdates(entry1, 2000);\n            page.watchEntryUpdates(entry2, 1000);\n            page.watchEntryUpdates(entry3, 2000);\n\n            expect(scheduledCallback).not.toBe(null);\n\n            expect(page._scheduleCheckUpdates).toHaveBeenCalled();\n            expect(page._watchedUpdatesLastScheduleTime).not.toBe(null);\n            expect(page._watchedUpdatesTimeout).not.toBe(null);\n\n            scheduledCallback();\n\n            expect(page._watchedUpdatesLastScheduleTime).not.toBe(null);\n            expect(page._watchedUpdatesTimeout).toBe(null);\n            expect(page._loadUpdates.calls.count()).toBe(1);\n            expect(page._loadUpdates.calls.mostRecent().args[0].entries)\n                .toEqual([entry1, entry2, entry3]);\n\n            expect(Backbone.sync.calls.count()).toBe(1);\n\n            const callOptions = Backbone.sync.calls.mostRecent().args[2];\n            expect(callOptions.url)\n                .toBe('/r/123/_updates/?entries=my-entry:100,200' +\n                      ';another-entry:foo');\n            expect(callOptions.noActivityIndicator).toBe(true);\n            expect(callOptions.dataType).toBe('text');\n        });\n\n        describe('Response parsing', function() {\n            const TestEntry = RB.ReviewRequestPage.Entry.extend({\n                parse(rsp) {\n                    return _.extend({\n                        myAttr: rsp.myAttr,\n                    }, RB.ReviewRequestPage.Entry.prototype.parse.call(this,\n                                                                       rsp));\n                },\n            });\n\n            let entry1;\n            let entry2;\n\n            beforeEach(function() {\n                spyOn(page, 'trigger').and.callThrough();\n\n                entry1 = new TestEntry({\n                    typeID: 'my-entry',\n                    id: '1',\n                    addedTimestamp: new Date(2017, 7, 1, 0, 0, 0),\n                    updatedTimestamp: new Date(2017, 7, 1, 12, 0, 0),\n                });\n\n                entry2 = new TestEntry({\n                    typeID: 'my-entry',\n                    id: '2',\n                    addedTimestamp: new Date(2017, 7, 1, 0, 0, 0),\n                    updatedTimestamp: new Date(2017, 7, 1, 12, 0, 0),\n                });\n\n                page.addEntry(entry1);\n                page.addEntry(entry2);\n            });\n\n            it('Updates to outdated entries', function() {\n                spyOn(entry1, 'beforeApplyUpdate');\n                spyOn(entry1, 'afterApplyUpdate');\n                spyOn(entry2, 'beforeApplyUpdate');\n                spyOn(entry2, 'afterApplyUpdate');\n\n                page._processUpdates([\n                    '177\\n',\n                    '{\"type\": \"entry\", \"entryType\": \"my-entry\", ',\n                    '\"entryID\": \"1\", \"addedTimestamp\": \"2017-07-01T00:00:00\", ',\n                    '\"updatedTimestamp\": \"2017-09-04T14:30:20\", ',\n                    '\"modelData\": {\"myAttr\": \"value1\"}}',\n                    '15\\n',\n                    '<p>My HTML!</p>',\n                    '177\\n',\n                    '{\"type\": \"entry\", \"entryType\": \"my-entry\", ',\n                    '\"entryID\": \"2\", \"addedTimestamp\": \"2017-07-01T00:00:00\", ',\n                    '\"updatedTimestamp\": \"2017-09-03T14:30:20\", ',\n                    '\"modelData\": {\"myAttr\": \"value2\"}}',\n                    '13\\n',\n                    '<p>Oh hi!</p>',\n                ].join(''));\n\n                /* Check the first entry's updates and events. */\n                const metadata1 = {\n                    type: 'entry',\n                    entryType: 'my-entry',\n                    entryID: '1',\n                    addedTimestamp: '2017-07-01T00:00:00',\n                    updatedTimestamp: '2017-09-04T14:30:20',\n                    modelData: {\n                        myAttr: 'value1',\n                    },\n                };\n                const html1 = '<p>My HTML!</p>';\n\n                expect(entry1.get('myAttr')).toBe('value1');\n                expect(entry1.beforeApplyUpdate)\n                    .toHaveBeenCalledWith(metadata1);\n                expect(entry1.afterApplyUpdate)\n                    .toHaveBeenCalledWith(metadata1);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'applyingUpdate:entry', metadata1, html1);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'applyingUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedModelUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedUpdate:entry', metadata1, html1);\n\n                /* Check the second entry's updates and events. */\n                const metadata2 = {\n                    type: 'entry',\n                    entryType: 'my-entry',\n                    entryID: '2',\n                    addedTimestamp: '2017-07-01T00:00:00',\n                    updatedTimestamp: '2017-09-03T14:30:20',\n                    modelData: {\n                        myAttr: 'value2',\n                    },\n                };\n                const html2 = '<p>Oh hi!</p>';\n\n                expect(entry2.get('myAttr')).toBe('value2');\n                expect(entry2.beforeApplyUpdate)\n                    .toHaveBeenCalledWith(metadata2);\n                expect(entry2.afterApplyUpdate)\n                    .toHaveBeenCalledWith(metadata2);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'applyingUpdate:entry', metadata2, html2);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'applyingUpdate:entry:2', metadata2, html2);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedModelUpdate:entry:2', metadata2, html2);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedUpdate:entry:2', metadata2, html2);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedUpdate:entry', metadata2, html2);\n\n                expect(page.trigger).toHaveBeenCalledWith('updatesProcessed');\n            });\n\n            it('Updates to up-to-date entries', function() {\n                entry1.set('myAttr', 'existing-value');\n\n                spyOn(entry1, 'beforeApplyUpdate');\n                spyOn(entry1, 'afterApplyUpdate');\n\n                page._processUpdates([\n                    '177\\n',\n                    '{\"type\": \"entry\", \"entryType\": \"my-entry\", ',\n                    '\"entryID\": \"1\", \"addedTimestamp\": \"2016-09-04T14:30:20\", ',\n                    '\"updatedTimestamp\": \"2016-12-10T12:24:14\", ',\n                    '\"modelData\": {\"myAttr\": \"value1\"}}',\n                    '15\\n',\n                    '<p>My HTML!</p>',\n                ].join(''));\n\n                /* Check the first entry's updates and events. */\n                const metadata1 = {\n                    type: 'entry',\n                    entryType: 'my-entry',\n                    entryID: '1',\n                    addedTimestamp: '2016-09-04T14:30:20',\n                    updatedTimestamp: '2016-09-04T14:30:20',\n                    modelData: {\n                        myAttr: 'value1',\n                    },\n                };\n                const html1 = '<p>My HTML!</p>';\n\n                expect(entry1.get('myAttr')).toBe('existing-value');\n                expect(entry1.beforeApplyUpdate).not.toHaveBeenCalled();\n                expect(entry1.afterApplyUpdate).not.toHaveBeenCalled();\n                expect(page.trigger).not.toHaveBeenCalledWith(\n                    'applyingUpdate:entry', metadata1, html1);\n                expect(page.trigger).not.toHaveBeenCalledWith(\n                    'applyingUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).not.toHaveBeenCalledWith(\n                    'appliedModelUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).not.toHaveBeenCalledWith(\n                    'appliedUpdate:entry:1', metadata1, html1);\n                expect(page.trigger).not.toHaveBeenCalledWith(\n                    'appliedUpdate:entry', metadata1, html1);\n\n                expect(page.trigger).toHaveBeenCalledWith('updatesProcessed');\n            });\n\n            it('Updates to non-entries', function() {\n                page._processUpdates([\n                    '35\\n{\"type\": \"something\", \"foo\": \"bar\"}',\n                    '20\\n<div>Something</div>',\n                ].join(''));\n\n                const metadata = {\n                    type: 'something',\n                    foo: 'bar',\n                };\n                const html = '<div>Something</div>';\n\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'applyingUpdate:something', metadata, html);\n                expect(page.trigger).toHaveBeenCalledWith(\n                    'appliedUpdate:something', metadata, html);\n\n                expect(page.trigger).toHaveBeenCalledWith('updatesProcessed');\n            });\n        });\n    });\n});\n"]}