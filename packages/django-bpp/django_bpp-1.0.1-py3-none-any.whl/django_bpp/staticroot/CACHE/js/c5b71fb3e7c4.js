!function($){function UTCDate(){return new Date(Date.UTC.apply(Date,arguments));}
function UTCToday(){var today=new Date();return UTCDate(today.getUTCFullYear(),today.getUTCMonth(),today.getUTCDate());}
var Datepicker=function(element,options){var that=this;this.element=$(element);this.autoShow=(options.autoShow==undefined?true:options.autoShow);this.appendTo=options.appendTo||'body';this.closeButton=options.closeButton;this.language=options.language||this.element.data('date-language')||"en";this.language=this.language in dates?this.language:this.language.split('-')[0];this.language=this.language in dates?this.language:"en";this.isRTL=dates[this.language].rtl||false;this.format=DPGlobal.parseFormat(options.format||this.element.data('date-format')||dates[this.language].format||'mm/dd/yyyy');this.formatText=options.format||this.element.data('date-format')||dates[this.language].format||'mm/dd/yyyy';this.isInline=false;this.isInput=this.element.is('input');this.component=this.element.is('.date')?this.element.find('.prefix, .postfix'):false;this.hasInput=this.component&&this.element.find('input').length;this.disableDblClickSelection=options.disableDblClickSelection;this.onRender=options.onRender||function(){};if(this.component&&this.component.length===0){this.component=false;}
this.linkField=options.linkField||this.element.data('link-field')||false;this.linkFormat=DPGlobal.parseFormat(options.linkFormat||this.element.data('link-format')||'yyyy-mm-dd hh:ii:ss');this.minuteStep=options.minuteStep||this.element.data('minute-step')||5;this.pickerPosition=options.pickerPosition||this.element.data('picker-position')||'bottom-right';this.initialDate=options.initialDate||null;this.faCSSprefix=options.faCSSprefix||'fa';this.leftArrow=options.leftArrow||'<i class="'+this.faCSSprefix+' '+this.faCSSprefix+'-chevron-left fi-arrow-left"/>';this.rightArrow=options.rightArrow||'<i class="'+this.faCSSprefix+' '+this.faCSSprefix+'-chevron-right fi-arrow-right"/>';this.closeIcon=options.closeIcon||'<i class="'+this.faCSSprefix+' '+this.faCSSprefix+'-remove '+this.faCSSprefix+'-times fi-x"></i>';this.minView=0;if('minView'in options){this.minView=options.minView;}else if('minView'in this.element.data()){this.minView=this.element.data('min-view');}
this.minView=DPGlobal.convertViewMode(this.minView);this.maxView=DPGlobal.modes.length-1;if('maxView'in options){this.maxView=options.maxView;}else if('maxView'in this.element.data()){this.maxView=this.element.data('max-view');}
this.maxView=DPGlobal.convertViewMode(this.maxView);this.startViewMode='month';if('startView'in options){this.startViewMode=options.startView;}else if('startView'in this.element.data()){this.startViewMode=this.element.data('start-view');}
this.startViewMode=DPGlobal.convertViewMode(this.startViewMode);this.viewMode=this.startViewMode;if(!('minView'in options)&&!('maxView'in options)&&!(this.element.data('min-view'))&&!(this.element.data('max-view'))){this.pickTime=false;if('pickTime'in options){this.pickTime=options.pickTime;}
if(this.pickTime==true){this.minView=0;this.maxView=4;}else{this.minView=2;this.maxView=4;}}
this.forceParse=true;if('forceParse'in options){this.forceParse=options.forceParse;}else if('dateForceParse'in this.element.data()){this.forceParse=this.element.data('date-force-parse');}
this.picker=$(DPGlobal.template(this.leftArrow,this.rightArrow,this.closeIcon)).appendTo(this.isInline?this.element:this.appendTo).on({click:$.proxy(this.click,this),mousedown:$.proxy(this.mousedown,this)});if(this.closeButton){this.picker.find('a.datepicker-close').show();}else{this.picker.find('a.datepicker-close').hide();}
if(this.isInline){this.picker.addClass('datepicker-inline');}else{this.picker.addClass('datepicker-dropdown dropdown-menu');}
if(this.isRTL){this.picker.addClass('datepicker-rtl');this.picker.find('.date-switch').each(function(){$(this).parent().prepend($(this).siblings('.next'));$(this).parent().append($(this).siblings('.prev'));})
this.picker.find('.prev, .next').toggleClass('prev next');}
$(document).on('mousedown',function(e){if(that.isInput&&e.target===that.element[0]){return;}
if($(e.target).closest('.datepicker.datepicker-inline, .datepicker.datepicker-dropdown').length===0){that.hide();}});this.autoclose=true;if('autoclose'in options){this.autoclose=options.autoclose;}else if('dateAutoclose'in this.element.data()){this.autoclose=this.element.data('date-autoclose');}
this.keyboardNavigation=true;if('keyboardNavigation'in options){this.keyboardNavigation=options.keyboardNavigation;}else if('dateKeyboardNavigation'in this.element.data()){this.keyboardNavigation=this.element.data('date-keyboard-navigation');}
this.todayBtn=(options.todayBtn||this.element.data('date-today-btn')||false);this.todayHighlight=(options.todayHighlight||this.element.data('date-today-highlight')||false);this.calendarWeeks=false;if('calendarWeeks'in options){this.calendarWeeks=options.calendarWeeks;}else if('dateCalendarWeeks'in this.element.data()){this.calendarWeeks=this.element.data('date-calendar-weeks');}
if(this.calendarWeeks)
this.picker.find('tfoot th.today').attr('colspan',function(i,val){return parseInt(val)+1;});this.weekStart=((options.weekStart||this.element.data('date-weekstart')||dates[this.language].weekStart||0)%7);this.weekEnd=((this.weekStart+6)%7);this.startDate=-Infinity;this.endDate=Infinity;this.daysOfWeekDisabled=[];this.datesDisabled=[];this.setStartDate(options.startDate||this.element.data('date-startdate'));this.setEndDate(options.endDate||this.element.data('date-enddate'));this.setDaysOfWeekDisabled(options.daysOfWeekDisabled||this.element.data('date-days-of-week-disabled'));this.setDatesDisabled(options.datesDisabled||this.element.data('dates-disabled'));this.fillDow();this.fillMonths();this.update();this.showMode();if(this.isInline){this.show();}
this._attachEvents();};Datepicker.prototype={constructor:Datepicker,_events:[],_attachEvents:function(){this._detachEvents();if(this.isInput){if(!this.keyboardNavigation){this._events=[[this.element,{focus:(this.autoShow)?$.proxy(this.show,this):function(){}}]];}else{this._events=[[this.element,{focus:(this.autoShow)?$.proxy(this.show,this):function(){},keyup:$.proxy(this.update,this),keydown:$.proxy(this.keydown,this),click:(this.element.attr('readonly'))?$.proxy(this.show,this):function(){}}]];}}
else if(this.component&&this.hasInput){this._events=[[this.element.find('input'),{focus:(this.autoShow)?$.proxy(this.show,this):function(){},keyup:$.proxy(this.update,this),keydown:$.proxy(this.keydown,this)}],[this.component,{click:$.proxy(this.show,this)}]];}else if(this.element.is('div')){this.isInline=true;}else{this._events=[[this.element,{click:$.proxy(this.show,this)}]];}
if(this.disableDblClickSelection){this._events[this._events.length]=[this.element,{dblclick:function(e){e.preventDefault();e.stopPropagation();$(this).blur()}}];}
for(var i=0,el,ev;i<this._events.length;i++){el=this._events[i][0];ev=this._events[i][1];el.on(ev);}},_detachEvents:function(){for(var i=0,el,ev;i<this._events.length;i++){el=this._events[i][0];ev=this._events[i][1];el.off(ev);}
this._events=[];},show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.update();this.place();$(window).on('resize',$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault();}
this.element.trigger({type:'show',date:this.date});},hide:function(e){if(this.isInline)return;if(!this.picker.is(':visible'))return;this.picker.hide();$(window).off('resize',this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){$(document).off('mousedown',this.hide);}
if(this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find('input').val()))
this.setValue();this.element.trigger({type:'hide',date:this.date});},remove:function(){this._detachEvents();this.picker.remove();delete this.element.data().datepicker;},getDate:function(){var d=this.getUTCDate();return new Date(d.getTime()+(d.getTimezoneOffset()*60000));},getUTCDate:function(){return this.date;},setDate:function(d){this.setUTCDate(new Date(d.getTime()-(d.getTimezoneOffset()*60000)));},setUTCDate:function(d){this.date=d;this.setValue();},setValue:function(){var formatted=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find('input').val(formatted);}
this.element.data('date',formatted);}else{this.element.val(formatted);}},getFormattedDate:function(format){if(format===undefined)
format=this.format;return DPGlobal.formatDate(this.date,format,this.language);},setStartDate:function(startDate){this.startDate=startDate||-Infinity;if(this.startDate!==-Infinity){this.startDate=DPGlobal.parseDate(this.startDate,this.format,this.language);}
this.update();this.updateNavArrows();},setEndDate:function(endDate){this.endDate=endDate||Infinity;if(this.endDate!==Infinity){this.endDate=DPGlobal.parseDate(this.endDate,this.format,this.language);}
this.update();this.updateNavArrows();},setDaysOfWeekDisabled:function(daysOfWeekDisabled){this.daysOfWeekDisabled=daysOfWeekDisabled||[];if(!$.isArray(this.daysOfWeekDisabled)){this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/);}
this.daysOfWeekDisabled=$.map(this.daysOfWeekDisabled,function(d){return parseInt(d,10);});this.update();this.updateNavArrows();},setDatesDisabled:function(datesDisabled){this.datesDisabled=datesDisabled||[];if(!$.isArray(this.datesDisabled)){this.datesDisabled=this.datesDisabled.split(/,\s*/);}
this.datesDisabled=$.map(this.datesDisabled,function(d){return DPGlobal.parseDate(d,this.format,this.language).valueOf();});this.update();this.updateNavArrows();},place:function(){if(this.isInline)return;var zIndex=parseInt(this.element.parents().filter(function(){return $(this).css('z-index')!='auto';}).first().css('z-index'))+10;var textbox=this.component?this.component:this.element;var offset=textbox.offset();var height=textbox.outerHeight()+parseInt(textbox.css('margin-top'));var width=textbox.outerWidth()+parseInt(textbox.css('margin-left'));var fullOffsetTop=offset.top+height;var offsetLeft=offset.left;this.picker.removeClass('datepicker-top datepicker-bottom');if((fullOffsetTop+this.picker.outerHeight())>=$(window).scrollTop()+$(window).height()){fullOffsetTop=offset.top-this.picker.outerHeight();this.picker.addClass('datepicker-top');}
else{this.picker.addClass('datepicker-bottom');}
if(offset.left+this.picker.width()>=$(window).width()){offsetLeft=(offset.left+width)-this.picker.width();}
this.picker.css({top:fullOffsetTop,left:offsetLeft,zIndex:zIndex});},update:function(){var date,fromArgs=false;var currentVal=this.isInput?this.element.val():this.element.data('date')||this.element.find('input').val();if(arguments&&arguments.length&&(typeof arguments[0]==='string'||arguments[0]instanceof Date)){date=arguments[0];fromArgs=true;}
else if(!currentVal&&this.initialDate!=null){date=this.initialDate}
else{date=this.isInput?this.element.val():this.element.data('date')||this.element.find('input').val();}
if(date&&date.length>this.formatText.length){$(this.picker).addClass('is-invalid')
$(this.element).addClass('is-invalid-input')
return;}else{$(this.picker).removeClass('is-invalid')
$(this.element).removeClass('is-invalid-input')}
this.date=DPGlobal.parseDate(date,this.format,this.language);if(fromArgs||this.initialDate!=null)this.setValue();if(this.date<this.startDate){this.viewDate=new Date(this.startDate.valueOf());}else if(this.date>this.endDate){this.viewDate=new Date(this.endDate.valueOf());}else{this.viewDate=new Date(this.date.valueOf());}
this.fill();},fillDow:function(){var dowCnt=this.weekStart,html='<tr>';if(this.calendarWeeks){var cell='<th class="cw">&nbsp;</th>';html+=cell;this.picker.find('.datepicker-days thead tr:first-child').prepend(cell);}
while(dowCnt<this.weekStart+7){html+='<th class="dow">'+dates[this.language].daysMin[(dowCnt++)%7]+'</th>';}
html+='</tr>';this.picker.find('.datepicker-days thead').append(html);},fillMonths:function(){var html='',i=0;while(i<12){html+='<span class="month">'+dates[this.language].monthsShort[i++]+'</span>';}
this.picker.find('.datepicker-months td').html(html);},fill:function(){if(this.date==null||this.viewDate==null){return;}
var d=new Date(this.viewDate.valueOf()),year=d.getUTCFullYear(),month=d.getUTCMonth(),dayMonth=d.getUTCDate(),hours=d.getUTCHours(),minutes=d.getUTCMinutes(),startYear=this.startDate!==-Infinity?this.startDate.getUTCFullYear():-Infinity,startMonth=this.startDate!==-Infinity?this.startDate.getUTCMonth():-Infinity,endYear=this.endDate!==Infinity?this.endDate.getUTCFullYear():Infinity,endMonth=this.endDate!==Infinity?this.endDate.getUTCMonth():Infinity,currentDate=this.date&&UTCDate(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),today=new Date(),titleFormat=dates[this.language].titleFormat||dates['en'].titleFormat;this.picker.find('.datepicker-days thead th:eq(1)').text(dates[this.language].months[month]+' '+year);this.picker.find('.datepicker-hours thead th:eq(1)').text(dayMonth+' '+dates[this.language].months[month]+' '+year);this.picker.find('.datepicker-minutes thead th:eq(1)').text(dayMonth+' '+dates[this.language].months[month]+' '+year);this.picker.find('tfoot th.today').text(dates[this.language].today).toggle(this.todayBtn!==false);this.updateNavArrows();this.fillMonths();var prevMonth=UTCDate(year,month-1,28,0,0,0,0),day=DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(),prevMonth.getUTCMonth());prevMonth.setUTCDate(day);prevMonth.setUTCDate(day-(prevMonth.getUTCDay()-this.weekStart+7)%7);var nextMonth=new Date(prevMonth.valueOf());nextMonth.setUTCDate(nextMonth.getUTCDate()+42);nextMonth=nextMonth.valueOf();var html=[];var clsName;while(prevMonth.valueOf()<nextMonth){if(prevMonth.getUTCDay()==this.weekStart){html.push('<tr>');if(this.calendarWeeks){var a=new Date(prevMonth.getUTCFullYear(),prevMonth.getUTCMonth(),prevMonth.getUTCDate()-prevMonth.getDay()+10-(this.weekStart&&this.weekStart%7<5&&7)),b=new Date(a.getFullYear(),0,4),calWeek=~~((a-b)/864e5/7+1.5);html.push('<td class="cw">'+calWeek+'</td>');}}
clsName=' '+this.onRender(prevMonth)+' ';if(prevMonth.getUTCFullYear()<year||(prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()<month)){clsName+=' old';}else if(prevMonth.getUTCFullYear()>year||(prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()>month)){clsName+=' new';}
if(this.todayHighlight&&prevMonth.getUTCFullYear()==today.getFullYear()&&prevMonth.getUTCMonth()==today.getMonth()&&prevMonth.getUTCDate()==today.getDate()){clsName+=' today';}
if(currentDate&&prevMonth.valueOf()==currentDate){clsName+=' active';}
if(prevMonth.valueOf()<this.startDate||prevMonth.valueOf()>this.endDate||$.inArray(prevMonth.getUTCDay(),this.daysOfWeekDisabled)!==-1||$.inArray(prevMonth.valueOf(),this.datesDisabled)!==-1){clsName+=' disabled';}
html.push('<td class="day'+clsName+'">'+prevMonth.getUTCDate()+'</td>');if(prevMonth.getUTCDay()==this.weekEnd){html.push('</tr>');}
prevMonth.setUTCDate(prevMonth.getUTCDate()+1);}
this.picker.find('.datepicker-days tbody').empty().append(html.join(''));html=[];for(var i=0;i<24;i++){var actual=UTCDate(year,month,dayMonth,i);clsName='';if((actual.valueOf()+3600000)<this.startDate||actual.valueOf()>this.endDate){clsName+=' disabled';}else if(hours==i){clsName+=' active';}
html.push('<span class="hour'+clsName+'">'+i+':00</span>');}
this.picker.find('.datepicker-hours td').html(html.join(''));html=[];for(var i=0;i<60;i+=this.minuteStep){var actual=UTCDate(year,month,dayMonth,hours,i);clsName='';if(actual.valueOf()<this.startDate||actual.valueOf()>this.endDate){clsName+=' disabled';}else if(Math.floor(minutes/this.minuteStep)==Math.floor(i/this.minuteStep)){clsName+=' active';}
html.push('<span class="minute'+clsName+'">'+hours+':'+(i<10?'0'+i:i)+'</span>');}
this.picker.find('.datepicker-minutes td').html(html.join(''));var currentYear=this.date&&this.date.getUTCFullYear();var months=this.picker.find('.datepicker-months').find('th:eq(1)').text(year).end().find('span').removeClass('active');if(currentYear&&currentYear==year){months.eq(this.date.getUTCMonth()).addClass('active');}
if(year<startYear||year>endYear){months.addClass('disabled');}
if(year==startYear){months.slice(0,startMonth).addClass('disabled');}
if(year==endYear){months.slice(endMonth+1).addClass('disabled');}
html='';year=parseInt(year/10,10)*10;var yearCont=this.picker.find('.datepicker-years').find('th:eq(1)').text(year+'-'+(year+9)).end().find('td');year-=1;for(var i=-1;i<11;i++){html+='<span class="year'+(i==-1||i==10?' old':'')+(currentYear==year?' active':'')+(year<startYear||year>endYear?' disabled':'')+'">'+year+'</span>';year+=1;}
yearCont.html(html);},updateNavArrows:function(){var d=new Date(this.viewDate),year=d.getUTCFullYear(),month=d.getUTCMonth(),day=d.getUTCDate(),hour=d.getUTCHours();switch(this.viewMode){case 0:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()&&month<=this.startDate.getUTCMonth()&&day<=this.startDate.getUTCDate()&&hour<=this.startDate.getUTCHours()){this.picker.find('.prev').css({visibility:'hidden'});}else{this.picker.find('.prev').css({visibility:'visible'});}
if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()&&month>=this.endDate.getUTCMonth()&&day>=this.endDate.getUTCDate()&&hour>=this.endDate.getUTCHours()){this.picker.find('.next').css({visibility:'hidden'});}else{this.picker.find('.next').css({visibility:'visible'});}
break;case 1:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()&&month<=this.startDate.getUTCMonth()&&day<=this.startDate.getUTCDate()){this.picker.find('.prev').css({visibility:'hidden'});}else{this.picker.find('.prev').css({visibility:'visible'});}
if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()&&month>=this.endDate.getUTCMonth()&&day>=this.endDate.getUTCDate()){this.picker.find('.next').css({visibility:'hidden'});}else{this.picker.find('.next').css({visibility:'visible'});}
break;case 2:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()&&month<=this.startDate.getUTCMonth()){this.picker.find('.prev').css({visibility:'hidden'});}else{this.picker.find('.prev').css({visibility:'visible'});}
if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()&&month>=this.endDate.getUTCMonth()){this.picker.find('.next').css({visibility:'hidden'});}else{this.picker.find('.next').css({visibility:'visible'});}
break;case 3:case 4:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()){this.picker.find('.prev').css({visibility:'hidden'});}else{this.picker.find('.prev').css({visibility:'visible'});}
if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()){this.picker.find('.next').css({visibility:'hidden'});}else{this.picker.find('.next').css({visibility:'visible'});}
break;}},click:function(e){e.stopPropagation();e.preventDefault();if($(e.target).hasClass('datepicker-close')||$(e.target).parent().hasClass('datepicker-close')){this.hide();}
var target=$(e.target).closest('span, td, th');if(target.length==1){if(target.is('.disabled')){this.element.trigger({type:'outOfRange',date:this.viewDate,startDate:this.startDate,endDate:this.endDate});return;}
switch(target[0].nodeName.toLowerCase()){case'th':switch(target[0].className){case'date-switch':this.showMode(1);break;case'prev':case'next':var dir=DPGlobal.modes[this.viewMode].navStep*(target[0].className=='prev'?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,dir);break;case 1:this.viewDate=this.moveDate(this.viewDate,dir);break;case 2:this.viewDate=this.moveMonth(this.viewDate,dir);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,dir);break;}
this.fill();break;case'today':var date=new Date();date=UTCDate(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds());this.viewMode=this.startViewMode;this.showMode(0);this._setDate(date);break;}
break;case'span':if(!target.is('.disabled')){if(target.is('.month')){if(this.minView===3){var month=target.parent().find('span').index(target)||0;var year=this.viewDate.getUTCFullYear(),day=1,hours=this.viewDate.getUTCHours(),minutes=this.viewDate.getUTCMinutes(),seconds=this.viewDate.getUTCSeconds();this._setDate(UTCDate(year,month,day,hours,minutes,seconds,0));}else{this.viewDate.setUTCDate(1);var month=target.parent().find('span').index(target);this.viewDate.setUTCMonth(month);this.element.trigger({type:'changeMonth',date:this.viewDate});}}else if(target.is('.year')){if(this.minView===4){var year=parseInt(target.text(),10)||0;var month=0,day=1,hours=this.viewDate.getUTCHours(),minutes=this.viewDate.getUTCMinutes(),seconds=this.viewDate.getUTCSeconds();this._setDate(UTCDate(year,month,day,hours,minutes,seconds,0));}else{this.viewDate.setUTCDate(1);var year=parseInt(target.text(),10)||0;this.viewDate.setUTCFullYear(year);this.element.trigger({type:'changeYear',date:this.viewDate});}}else if(target.is('.hour')){var hours=parseInt(target.text(),10)||0;var year=this.viewDate.getUTCFullYear(),month=this.viewDate.getUTCMonth(),day=this.viewDate.getUTCDate(),minutes=this.viewDate.getUTCMinutes(),seconds=this.viewDate.getUTCSeconds();this._setDate(UTCDate(year,month,day,hours,minutes,seconds,0));}else if(target.is('.minute')){var minutes=parseInt(target.text().substr(target.text().indexOf(':')+1),10)||0;var year=this.viewDate.getUTCFullYear(),month=this.viewDate.getUTCMonth(),day=this.viewDate.getUTCDate(),hours=this.viewDate.getUTCHours(),seconds=this.viewDate.getUTCSeconds();this._setDate(UTCDate(year,month,day,hours,minutes,seconds,0));}
if(this.viewMode!=0){var oldViewMode=this.viewMode;this.showMode(-1);this.fill();if(oldViewMode==this.viewMode&&this.autoclose){this.hide();}}else{this.fill();if(this.autoclose){this.hide();}}}
break;case'td':if(target.is('.day')&&!target.is('.disabled')){var day=parseInt(target.text(),10)||1;var year=this.viewDate.getUTCFullYear(),month=this.viewDate.getUTCMonth(),hours=this.viewDate.getUTCHours(),minutes=this.viewDate.getUTCMinutes(),seconds=this.viewDate.getUTCSeconds();if(target.is('.old')){if(month===0){month=11;year-=1;}else{month-=1;}}else if(target.is('.new')){if(month==11){month=0;year+=1;}else{month+=1;}}
this._setDate(UTCDate(year,month,day,hours,minutes,seconds,0));}
var oldViewMode=this.viewMode;this.showMode(-1);this.fill();if(oldViewMode==this.viewMode&&this.autoclose){this.hide();}
break;}}},_setDate:function(date,which){if(!which||which=='date')
this.date=date;if(!which||which=='view')
this.viewDate=date;this.fill();this.setValue();this.element.trigger({type:'changeDate',date:this.date});var element;if(this.isInput){element=this.element;}else if(this.component){element=this.element.find('input');}
if(element){element.change();if(this.autoclose&&(!which||which=='date')){}}},moveHour:function(date,dir){if(!dir)return date;var new_date=new Date(date.valueOf());dir=dir>0?1:-1;new_date.setUTCHours(new_date.getUTCHours()+dir);return new_date;},moveDate:function(date,dir){if(!dir)return date;var new_date=new Date(date.valueOf());dir=dir>0?1:-1;new_date.setUTCDate(new_date.getUTCDate()+dir);return new_date;},moveMonth:function(date,dir){if(!dir)return date;var new_date=new Date(date.valueOf()),day=new_date.getUTCDate(),month=new_date.getUTCMonth(),mag=Math.abs(dir),new_month,test;dir=dir>0?1:-1;if(mag==1){test=dir==-1?function(){return new_date.getUTCMonth()==month;}:function(){return new_date.getUTCMonth()!=new_month;};new_month=month+dir;new_date.setUTCMonth(new_month);if(new_month<0||new_month>11)
new_month=(new_month+12)%12;}else{for(var i=0;i<mag;i++)
new_date=this.moveMonth(new_date,dir);new_month=new_date.getUTCMonth();new_date.setUTCDate(day);test=function(){return new_month!=new_date.getUTCMonth();};}
while(test()){new_date.setUTCDate(--day);new_date.setUTCMonth(new_month);}
return new_date;},moveYear:function(date,dir){return this.moveMonth(date,dir*12);},dateWithinRange:function(date){return date>=this.startDate&&date<=this.endDate;},keydown:function(e){if(!this.keyboardNavigation){return true;}
if(this.picker.is(':not(:visible)')){if(e.keyCode==27)
this.show();return;}
var dateChanged=false,dir,day,month,newDate,newViewDate;switch(e.keyCode){case 27:this.hide();e.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;dir=e.keyCode==37?-1:1;if(e.ctrlKey){newDate=this.moveYear(this.date,dir);newViewDate=this.moveYear(this.viewDate,dir);}else if(e.shiftKey){newDate=this.moveMonth(this.date,dir);newViewDate=this.moveMonth(this.viewDate,dir);}else{newDate=new Date(this.date.valueOf());newDate.setUTCDate(this.date.getUTCDate()+dir);newViewDate=new Date(this.viewDate.valueOf());newViewDate.setUTCDate(this.viewDate.getUTCDate()+dir);}
if(this.dateWithinRange(newDate)){this.date=newDate;this.viewDate=newViewDate;this.setValue();this.update();e.preventDefault();dateChanged=true;}
break;case 38:case 40:if(!this.keyboardNavigation)break;dir=e.keyCode==38?-1:1;if(e.ctrlKey){newDate=this.moveYear(this.date,dir);newViewDate=this.moveYear(this.viewDate,dir);}else if(e.shiftKey){newDate=this.moveMonth(this.date,dir);newViewDate=this.moveMonth(this.viewDate,dir);}else{newDate=new Date(this.date.valueOf());newDate.setUTCDate(this.date.getUTCDate()+dir*7);newViewDate=new Date(this.viewDate.valueOf());newViewDate.setUTCDate(this.viewDate.getUTCDate()+dir*7);}
if(this.dateWithinRange(newDate)){this.date=newDate;this.viewDate=newViewDate;this.setValue();this.update();e.preventDefault();dateChanged=true;}
break;case 13:this.hide();e.preventDefault();break;case 9:this.hide();break;}
if(dateChanged){this.element.trigger({type:'changeDate',date:this.date});var element;if(this.isInput){element=this.element;}else if(this.component){element=this.element.find('input');}
if(element){element.change();}}},showMode:function(dir){if(dir){var newViewMode=Math.max(0,Math.min(DPGlobal.modes.length-1,this.viewMode+dir));if(newViewMode>=this.minView&&newViewMode<=this.maxView){this.viewMode=newViewMode;}}
this.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).css('display','block');this.updateNavArrows();},changeViewDate:function(date){this.date=date;this.viewDate=date;this.fill();},reset:function(e){this._setDate(null,'date');}};$.fn.fdatepicker=function(option){var args=Array.apply(null,arguments);args.shift();return this.each(function(){var $this=$(this),data=$this.data('datepicker'),options=typeof option=='object'&&option;if(!data){$this.data('datepicker',(data=new Datepicker(this,$.extend({},$.fn.fdatepicker.defaults,options))));}
if(typeof option=='string'&&typeof data[option]=='function'){data[option].apply(data,args);}});};$.fn.fdatepicker.defaults={onRender:function(date){return'';}};$.fn.fdatepicker.Constructor=Datepicker;var dates=$.fn.fdatepicker.dates={'en':{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",titleFormat:"MM yyyy"}};var DPGlobal={modes:[{clsName:'minutes',navFnc:'Hours',navStep:1},{clsName:'hours',navFnc:'Date',navStep:1},{clsName:'days',navFnc:'Month',navStep:1},{clsName:'months',navFnc:'FullYear',navStep:1},{clsName:'years',navFnc:'FullYear',navStep:10}],isLeapYear:function(year){return(((year%4===0)&&(year%100!==0))||(year%400===0));},getDaysInMonth:function(year,month){return[31,(DPGlobal.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];},validParts:/hh?|ii?|ss?|dd?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(format){var separators=format.replace(this.validParts,'\0').split('\0'),parts=format.match(this.validParts);if(!separators||!separators.length||!parts||parts.length===0){throw new Error("Invalid date format.");}
this.formatText=format;return{separators:separators,parts:parts};},parseDate:function(date,format,language){if(date instanceof Date)return new Date(date.valueOf()-date.getTimezoneOffset()*60000);if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(date)){format=this.parseFormat('yyyy-mm-dd');}
if(/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(date)){format=this.parseFormat('yyyy-mm-dd hh:ii');}
if(/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(date)){format=this.parseFormat('yyyy-mm-dd hh:ii:ss');}
if(/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(date)){var part_re=/([-+]\d+)([dmwy])/,parts=date.match(/([-+]\d+)([dmwy])/g),part,dir;date=new Date();for(var i=0;i<parts.length;i++){part=part_re.exec(parts[i]);dir=parseInt(part[1]);switch(part[2]){case'd':date.setUTCDate(date.getUTCDate()+dir);break;case'm':date=Datetimepicker.prototype.moveMonth.call(Datetimepicker.prototype,date,dir);break;case'w':date.setUTCDate(date.getUTCDate()+dir*7);break;case'y':date=Datetimepicker.prototype.moveYear.call(Datetimepicker.prototype,date,dir);break;}}
return UTCDate(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds());}
var parts=date&&date.match(this.nonpunctuation)||[],date=new Date(),parsed={},setters_order=['hh','h','ii','i','ss','s','yyyy','yy','M','MM','m','mm','d','dd'],setters_map={hh:function(d,v){return d.setUTCHours(v);},h:function(d,v){return d.setUTCHours(v);},ii:function(d,v){return d.setUTCMinutes(v);},i:function(d,v){return d.setUTCMinutes(v);},ss:function(d,v){return d.setUTCSeconds(v);},s:function(d,v){return d.setUTCSeconds(v);},yyyy:function(d,v){return d.setUTCFullYear(v);},yy:function(d,v){return d.setUTCFullYear(2000+v);},m:function(d,v){v-=1;while(v<0)v+=12;v%=12;d.setUTCMonth(v);while(d.getUTCMonth()!=v)
d.setUTCDate(d.getUTCDate()-1);return d;},d:function(d,v){return d.setUTCDate(v);}},val,filtered,part;setters_map['M']=setters_map['MM']=setters_map['mm']=setters_map['m'];setters_map['dd']=setters_map['d'];date=UTCDate(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0);if(parts.length==format.parts.length){for(var i=0,cnt=format.parts.length;i<cnt;i++){val=parseInt(parts[i],10);part=format.parts[i];if(isNaN(val)){switch(part){case'MM':filtered=$(dates[language].months).filter(function(){var m=this.slice(0,parts[i].length),p=parts[i].slice(0,m.length);return m==p;});val=$.inArray(filtered[0],dates[language].months)+1;break;case'M':filtered=$(dates[language].monthsShort).filter(function(){var m=this.slice(0,parts[i].length),p=parts[i].slice(0,m.length);return m==p;});val=$.inArray(filtered[0],dates[language].monthsShort)+1;break;}}
parsed[part]=val;}
for(var i=0,s;i<setters_order.length;i++){s=setters_order[i];if(s in parsed&&!isNaN(parsed[s]))
setters_map[s](date,parsed[s])}}
return date;},formatDate:function(date,format,language){if(date==null){return'';}
var val={h:date.getUTCHours(),i:date.getUTCMinutes(),s:date.getUTCSeconds(),d:date.getUTCDate(),m:date.getUTCMonth()+1,M:dates[language].monthsShort[date.getUTCMonth()],MM:dates[language].months[date.getUTCMonth()],yy:date.getUTCFullYear().toString().substring(2),yyyy:date.getUTCFullYear()};val.hh=(val.h<10?'0':'')+val.h;val.ii=(val.i<10?'0':'')+val.i;val.ss=(val.s<10?'0':'')+val.s;val.dd=(val.d<10?'0':'')+val.d;val.mm=(val.m<10?'0':'')+val.m;var date=[],seps=$.extend([],format.separators);for(var i=0,cnt=format.parts.length;i<cnt;i++){if(seps.length)
date.push(seps.shift())
date.push(val[format.parts[i]]);}
return date.join('');},convertViewMode:function(viewMode){switch(viewMode){case 4:case'decade':viewMode=4;break;case 3:case'year':viewMode=3;break;case 2:case'month':viewMode=2;break;case 1:case'day':viewMode=1;break;case 0:case'hour':viewMode=0;break;}
return viewMode;},headTemplate:function(leftArrow,rightArrow){return('<thead>'+'<tr>'+'<th class="prev">'+leftArrow+'</th>'+'<th colspan="5" class="date-switch"></th>'+'<th class="next">'+rightArrow+'</th>'+'</tr>'+'</thead>')},contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};DPGlobal.template=function(leftArrow,rightArrow,closeIcon){return('<div class="datepicker">'+'<div class="datepicker-minutes">'+'<table class=" table-condensed">'+
DPGlobal.headTemplate(leftArrow,rightArrow)+
DPGlobal.contTemplate+
DPGlobal.footTemplate+'</table>'+'</div>'+'<div class="datepicker-hours">'+'<table class=" table-condensed">'+
DPGlobal.headTemplate(leftArrow,rightArrow)+
DPGlobal.contTemplate+
DPGlobal.footTemplate+'</table>'+'</div>'+'<div class="datepicker-days">'+'<table class=" table-condensed">'+
DPGlobal.headTemplate(leftArrow,rightArrow)+'<tbody></tbody>'+
DPGlobal.footTemplate+'</table>'+'</div>'+'<div class="datepicker-months">'+'<table class="table-condensed">'+
DPGlobal.headTemplate(leftArrow,rightArrow)+
DPGlobal.contTemplate+
DPGlobal.footTemplate+'</table>'+'</div>'+'<div class="datepicker-years">'+'<table class="table-condensed">'+
DPGlobal.headTemplate(leftArrow,rightArrow)+
DPGlobal.contTemplate+
DPGlobal.footTemplate+'</table>'+'</div>'+'<a class="button datepicker-close tiny alert right" style="width:auto;">'+closeIcon+'</a>'+'</div>')};$.fn.fdatepicker.DPGlobal=DPGlobal;}(window.jQuery);if(typeof String.prototype.startsWith!='function'){String.prototype.startsWith=function(str){return this.indexOf(str)==0;};}
if(window.multiseek==undefined)window.multiseek={};multiseek={frame_counter:0,field_counter:0,autocomplete_counter:0,LOAD_FORM_URL:'./load_form/',SAVE_FORM_URL:'./save_form/',widgetMapping:{'string':'multiseekStringValue','integer':'multiseekIntegerValue','decimal':'multiseekDecimalValue','value-list':'multiseekValueListValue','date':'multiseekDateValue','autocomplete':'multiseekAutocompleteValue','range':'multiseekRangeValue'}};function installDatePicker(element){if(element.fdatepicker){element.fdatepicker({format:multiseekDateFormat,weekStart:multiseekDateWeekStart,language:djangoLanguageCode});}else{element.datepicker($.datepicker.regional[djangoLanguageCode]);}}
$.widget("multiseek.multiseekBase",{getPrevOperationDOM:function(){return $("<select />").attr("id","prev-op").css("display","inline").append([$("<option/>").html(gettext("and")).attr("value","and"),$("<option/>").html(gettext("or")).attr("value","or"),$("<option/>").html(gettext("and not")).attr("value","andnot")])},prevOperation:function(action){var ph=this.element.find("#prev-op-placeholder");if(action=="enable"){if(ph.children().length==0)
ph.first().append(this.getPrevOperationDOM());}else if(action=="disable")
ph.first().remove()
else
return ph.first().children("#prev-op");},getPrevOperationValue:function(){var prev_op=this.prevOperation();if(prev_op)
return prev_op.val();return null;},enableOrDisablePrevOp:function(){if(this.element.prev().length){this.prevOperation("enable");return;}
this.prevOperation("disable");}});$.widget("multiseek.multiseekBaseValue",{_create:function(){},update:function(value,index){}});$.widget("multiseek.multiseekStringValue",$.multiseek.multiseekBaseValue,{_create:function(){this.element.append($('<input/>').attr("type","text").attr("name","value").attr("id","value").attr("size","30"));},getValue:function(){return this.element.children().first().val();},setValue:function(value){return this.element.children().first().val(value);}});$.widget("multiseek.multiseekIntegerValue",$.multiseek.multiseekStringValue,{getValue:function(){return parseInt(this.element.children().first().val());}});$.widget("multiseek.multiseekDecimalValue",$.multiseek.multiseekStringValue,{getValue:function(){return parseFloat(this.element.children().first().val()).toFixed(3);}});$.widget("multiseek.multiseekRangeValue",$.multiseek.multiseekBaseValue,{_create:function(){this.element.append($("<div/>").addClass("row collapse").append([$("<div/>").addClass("large-1 small-1 columns multiseek-range-field-label").text(gettext("from")),$("<div/>").addClass("large-5 small-5 columns").append([$("<input type=text id=value_min size=4 />")]),$("<div/>").addClass("large-1 small-1 columns multiseek-range-field-label").text(gettext("to")),$("<div/>").addClass("large-5 small-5 columns").append([$("<input type=text id=value_max size=4 />")])]));},getValue:function(){var min=this.element.find("input#value_min").val();var max=this.element.find("input#value_max").val();return JSON.stringify([parseInt(min),parseInt(max)]);},setValue:function(value){var value=$.parseJSON(value);this.element.find("input#value_min").val(value[0]);this.element.find("input#value_max").val(value[1]);}});$.widget("multiseek.multiseekAutocompleteValue",$.multiseek.multiseekBaseValue,{_create:function(){this.element.append($("<div/>").addClass("row collapse").append([$("<div/>").addClass("small-11 columns").append($("<input data-type=search id='value' type='text' />").prop("data-id",null).autocomplete({minLength:0,source:this.options.url,change:$.proxy(function(evt,ui){if(ui.item==null){alert(gettext("Please select value from the dropdown."));this.element.children().first().val('');this.element.children().first().focus();}
$(evt.target).attr("data-id",null);},this),select:function(evt,ui){$(evt.target).prop("data-id",ui.item.id);}})),$("<div/>").addClass("small-1 columns").append($("<span/>").addClass("postfix").text("X").click($.proxy(function(){this.element.find("#value").first().val('').focus();},this)))]));this.element.find("#value").focus(function(evt){$(evt.target).autocomplete("search");});},getValue:function(){return this.element.find("#value").first().prop("data-id");},setValue:function(value){value=$.parseJSON(value);var elem=this.element.find("#value").first();elem.prop("data-id",value[0]);elem.val(value[1]);}});$.widget("multiseek.multiseekValueListValue",$.multiseek.multiseekBaseValue,{_create:function(){var element=$('<select/>').attr("class","values").attr("name","value_list").attr("id","value");value_lists[this.options.fieldName].forEach(function(v){element.append($('<option/>').val(v).html(v));});this.element.append(element);},setValue:function(value){this.element.find("select[name=value_list]").val(value);},getValue:function(){return this.element.find("select[name=value_list]").val();}});$.widget("multiseek.multiseekDateValue",$.multiseek.multiseekBaseValue,{_create:function(){var element=$('<input/>').attr("type","text").attr("name","value").attr("id","value").attr("placeholder",gettext('today')).attr("size","10");installDatePicker(element);this.element.append($("<div/>").attr("class","row collapse").append([$("<div/>").attr("class","large-5 small-5 columns").append([element])]));},setValue:function(value){value=$.parseJSON(value);this.element.find("input[name=value]").val(value[0]);if(value.length>1)
this.element.find("input#value_max").val(value[1]);},getValue:function(){var ret=[this.element.find("input[name=value]").val()];this.element.find("input#value_max").each(function(no,elem){ret.push($(elem).val());})
return JSON.stringify(ret);},update:function(value,idx){var row=this.element.children().eq(0);if(idx>5){if(row.children().length==1){var element=$("<input/>").attr("type","text").attr("id","value_max").attr("placeholder",gettext('today')).attr("size","10");installDatePicker(element);row.append([$("<div/>").attr("class","large-2 small-2 columns").append($("<center/>").text("â€”")),$("<div/>").attr("class","large-5 small-5 columns").append([element])]);}}else{if(row.children().length>1){row.children().eq(1).remove();row.children().eq(1).remove();}}}});$.widget("multiseek.multiseekField",$.multiseek.multiseekBase,{_create:function(){this.typeSelect().change($.proxy(this.typeSelectChanged,this));this.opSelect().change($.proxy(this.opSelectChanged,this));this.setTypeSelectValues();this.enableOrDisablePrevOp();},typeSelect:function(){return this.element.find("#type");},typeSelectChanged:function(evt){this.initializeValueWidget();this.updateOpsSelect();},getFieldType:function(){return types[this.typeSelect().val()];},getFieldName:function(){return this.typeSelect().val();},getWidgetType:function(){return multiseek.widgetMapping[this.getFieldType()];},setTypeSelectValues:function(){var select=this.typeSelect();select.children().remove();fields.forEach(function(value){select.append($('<option/>').val(value).html(value));});this.typeSelect().change();},opSelect:function(){return this.element.find("#op");},opSelectChanged:function(evt){this.updateValueWidget();},updateOpsSelect:function(){var ops_select=this.opSelect();ops_select.children().remove();if(!ops[this.getFieldName()])
return;ops[this.getFieldName()].forEach(function(value){ops_select.append($('<option/>').val(value).html(value));});ops_select.change();},getFieldOp:function(){return ops[this.opSelect().val()];},valueElement:function(){return this.element.find("#value-placeholder").children().first();},initializeValueWidget:function(){var p=this.element.find("#value-placeholder");try{p[this.getWidgetType()]("destroy");}catch(Error){};p.children().remove();var x=p.append("<span/>");p=$(p.children()[0]);switch(this.getFieldType()){case'autocomplete':p.multiseekAutocompleteValue({'url':autocompletes[this.getFieldName()]})
break;default:p[this.getWidgetType()]({'fieldName':this.getFieldName()});break;}},updateValueWidget:function(){this.valueElement()[this.getWidgetType()]('update',this.opSelect().val(),this.opSelect()[0].selectedIndex);},setType:function(type){this.typeSelect().val(type);this.typeSelect().change();},setOperation:function(operation){this.opSelect().val(operation);this.opSelect().change();},setValueWidget:function(value){return this.valueElement()[this.getWidgetType()]('setValue',value);},getValue:function(){return this.valueElement()[this.getWidgetType()]('getValue');},serialize:function(){return{'field':this.getFieldName(),'operator':this.opSelect().val(),'value':this.getValue(),'prev_op':this.getPrevOperationValue()};},setValue:function(type,operation,value,prevOp){this.setType(type);this.setOperation(operation);this.setValueWidget(value);this.prevOperation().val(prevOp);}});$.multiseek.multiseekField.prototype.options={'type':0,'operation':0,'value':null};$.widget("multiseek.multiseekFrame",$.multiseek.multiseekBase,{makeFrameDOM:function(element){element.attr("id","frame-"+multiseek.frame_counter).attr("class","multiseekFrame").append([$('<div/>').attr("id","prev-op-placeholder"),$("<fieldset />").attr("class","multiseek-fieldset").append([$("<div/>").attr("id","field-list"),$("<button/>").attr("id","add_field").addClass("small").text(gettext("Add field")).click($.proxy(function(evt){evt.preventDefault();this.addFieldViaButton();},this))," ",$("<button/>").attr("id","add_frame").addClass("small").text(gettext("Add frame")).click($.proxy(function(evt){evt.preventDefault();this.addFrameViaButton();},this))])]);},_create:function(){this.makeFrameDOM(this.element);multiseek.frame_counter++;},fieldList:function(){return this.element.children("fieldset").children("#field-list");},noFields:function(){return this.fieldList().children().length;},empty:function(){return this.noFields()==0;},removeFrame:function(id){var for_removal=this.fieldList().find("#"+id);var next=for_removal.next();for_removal.remove()
next.multiseekBase().multiseekBase("enableOrDisablePrevOp");if(this.empty()&&this.element.attr("id")!="frame-0")
this.removeSelf();},parentFrame:function(){return this.element.parent().parent().parent();},removeSelf:function(){this.parentFrame().multiseekFrame("removeFrame",this.element.attr("id"));},removeField:function(evt){var fld=$("#"+$(evt.target).data("for-field"));if(this.noFields()==1&&this.element.attr("id")=="frame-0"){alert(last_field_remove_message);return;}
var next=fld.next();fld.remove();next.multiseekBase().multiseekBase("enableOrDisablePrevOp");if(this.empty())
this.removeSelf();},getFieldDOM:function(id){return $("<field/>").addClass("row collapse").attr("id",id).append([$("<div/>").addClass("large-1 small-2 columns").append($('<div/>').attr("id","prev-op-placeholder")),$("<div/>").addClass("large-3 small-6 small columns").append($("<select/>").attr("id","type")),$("<div/>").addClass("large-2 small-4 columns").append($("<select/>").attr("id","op")),$("<div/>").addClass("large-5 small-10 columns").attr("id","value-placeholder"),$("<div/>").addClass("large-1 small-2 columns").append($("<button/>").text("X").attr("id","close-button").addClass('small radius ').data("for-field",id).click($.proxy(function(evt){evt.preventDefault();this.removeField(evt);},this)))]);},addField:function(type,operation,value,op){var id="field-"+multiseek.field_counter;var has_elements=this.fieldList().children().length;var elem;elem=this.getFieldDOM(id);this.fieldList().append(elem);var fld=$("#"+id);fld.multiseekField();if(type&&operation)
fld.multiseekField("setValue",type,operation,value,op);multiseek.field_counter++;},addFieldViaButton:function(){this.addField();},addFrame:function(prevOpValue){var id="frame-"+multiseek.frame_counter;var has_elements=this.fieldList().children().length;this.fieldList().append($("<div/>").attr("id",id));var fr=$("#"+id);fr.multiseekFrame();if(has_elements){fr.multiseekFrame("prevOperation","enable");if(prevOpValue)
fr.multiseekFrame("prevOperation").val(prevOpValue);}
return fr;},addFrameViaButton:function(){var f=this.addFrame("and");f.multiseekFrame("addField");},serialize:function(){var ret=[];ret.push(this.getPrevOperationValue());this.fieldList().children().each($.proxy(function(no,elem){if($(elem).attr("id").startsWith("field")){ret.push($(elem).multiseekField("serialize"));return;}
ret.push($(elem).multiseekFrame("serialize"));},this));return ret;}});function formOrdering(){ret={};$(".multiseek-ordering").each(function(no,elem){pn="order_"+no;ret[pn]=$(elem).find(":selected").val();pn=pn+"_dir";if($("input[name="+pn+"]:checked").length)
ret[pn]="1";});return ret;}
function formReportType(){sel=$("select[name=_ms_report_type]");if(sel.length){return sel.val();}}
function formAsJSON(){return JSON.stringify({'form_data':$("#frame-0").multiseekFrame("serialize"),'ordering':formOrdering(),'report_type':formReportType()});}
function submitEvent(button){var value=formAsJSON();var form=$("<form/>").attr({method:"post",action:"./results/",target:"list_frame"}).append($("<input/>").attr('name','json').attr({"value":value}));$("body").append(form);form.submit().remove();}
function resetForm(button){location.href='./reset/';}
function updateFormSelector(pk,value){if($("#formsSelector option[value="+pk+"]").length==0)
$("#formsSelector").append($("<option/>").val(pk).html(value));$("#formsSelector").show();}
function saveForm(button){var dct={'json':formAsJSON(),'name':prompt(gettext("Form name?"))};if(dct.name==null)
return;if(dct.name==''){alert(gettext("Form name must not be empty."));return;}
dct.public=confirm(gettext("Should the form be available for every user of this website?"));var url=multiseek.SAVE_FORM_URL;var error=gettext('There was a server-side error. The form was NOT saved.');var saved=gettext('Form was saved.');var form_exists=gettext('There is already a form with such name in the database. Overwrite?');$.post(url,dct,function(data,textStatus,jqXHR){if(textStatus=='success'){if(data.result=='saved'){alert(saved);updateFormSelector(data.pk,dct['name']);}else if(data.result=='overwrite-prompt'){if(confirm(form_exists)){dct['overwrite']=true;$.post(url,dct,function(data,textStatus,jqXHR){if(textStatus=='success'){if(data.result=='saved'){alert(saved);updateFormSelector(data.pk,dct['name']);}else
alert(data.result);}else
alert(error);}).error(function(){alert(error);});;}}else
alert(data.result);}else
alert(err);}).fail(function(){alert(error);});}
function loadForm(select){if(confirm(gettext("Are you sure you want to load selected form?")))
location.href=multiseek.LOAD_FORM_URL+$(select).val();$(select).val('');}
window.multiseek.removeFromResults=function(id){var elem=$("#multiseek-row-"+id).children(".multiseek-element");var deco=elem.css("text-decoration");var css_after='line-through';var url='../remove-from-results/'+id
if(deco.startsWith("line-through")){css_after='none';url='../remove-from-removed-results/'+id;}
$.get(url,function(data){elem.css("text-decoration",css_after);});}