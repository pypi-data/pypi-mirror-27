<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>GRR User manual</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>GRR User manual</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>GRR is forensic framework focused on scalability enabling powerful analysis.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_high_level_overview">High-level overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>To function, an <a href="#agent"><em>agent</em></a> is deployed on systems that one might want to
investigate. Once deployed, each system becomes a GRR <a href="#client"><em>client</em></a> and
they can start receiving <a href="#message"><em>messages</em></a> from the frontend servers. Each
message tells the client to run a specific <a href="#client-action"><em>client action</em></a> and
return the results. A client action is simply some well known code the agent
knows how to execute (such as obtaining the list of files in a directory or
reading a buffer from a file).</p></div>
<div class="paragraph"><p>These actions are invoked server-side through what we call <a href="#flow"><em>flows</em></a>. A
<a href="#flow"><em>flow</em></a> is a piece of server-side code that asks the GRR system to
schedule remote calls to a client and has some additional logic to decide what
to do based on the call results.</p></div>
<div class="paragraph"><p>This <a href="#flow"><em>flow</em></a> is running on a client because a user initiated it. To do
so, he probably used the web-based Graphical User Interface (GUI), which allows
a GRR user to start flows for clients and review the results. Or he could also
have used the text-based <a href="#the-console"><em>console</em></a> to do the same.</p></div>
<div class="paragraph"><p>Any flow that can be run on a single machine can also be run as a Hunt. A hunt
allows running a flow on all, or any subset of machines talking to the GRR
server.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph"><p>Once we&#8217;ve got <a href="admin.adoc">the GRR server installed and running</a> we&#8217;ll want
to start deploying some agents.</p></div>
<div class="paragraph"><p>To do so we&#8217;ll need to:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download the specific agent version we need to install on the system.
</p>
</li>
<li>
<p>
Decide on a deployment method.
</p>
</li>
<li>
<p>
Perform the deployment and verify the results.
</p>
</li>
</ol></div>
<div class="sect2">
<h3 id="_downloading_agents">Downloading Agents</h3>
<div class="paragraph"><p>If your install went successfully, the agents should have been uploaded to the
server with working configurations, and should be available in the Admin UI.</p></div>
<div class="paragraph"><p>Look on the left for "Manage Binaries", the files should be in the executables
directory, under installers. The download button is the down arrown in the
toolbar.</p></div>
<div class="paragraph"><p>The files are also accessible directly if you know the path via /download. This
is useful if you want to retrieve the file using command line tools or a browser
that isn&#8217;t supported (e.g. IE6).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>wget --user=admin --password=setecastronomy http://example.com:8000/download/windows/installers/grr-installer-2209.exe</code></pre>
</div></div>
<div class="paragraph"><p>If your server configuration has changed your agents will need to be repacked
with an updated config. For details see:
<a href="admin.adoc#repacking-the-client-with-a-new-configuration">the GRR server
installed and running</a></p></div>
</div>
<div class="sect2">
<h3 id="_installing_the_agent">Installing the Agent</h3>
<div class="paragraph"><p>This differs significantly depending on the operating system so we split it into
separate sections below.</p></div>
<div class="paragraph"><p>If an install is successful, it should appear in the search UI within a few
seconds.</p></div>
<div class="sect3">
<h4 id="_windows">Windows</h4>
<div class="paragraph"><p>The Windows agents are special self extracting zipfiles. Just double click or
otherwise execute the binary. If you are not an administrator it will prompt
you for credentials.
It should then install silently in the background, unless you enabled the
 <a href="user_manual.doc#debugging-the-agent-install">verbose build</a></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_methods">Deployment methods</h3>
<div class="paragraph"><p>There are as many deployment methods as code execution paths exist. We&#8217;ll
discuss some of the most common ways and try to cover each platform.</p></div>
<div class="sect3">
<h4 id="_windows_deployment">Windows deployment</h4>
<div class="paragraph"><p>The most straightforward way to deploy a GRR agent to a Windows machine is to
use <a href="http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx">PsExec</a>.
PsExec allows one to execute commands on a remote system if credentials for a
valid user are known.</p></div>
<div class="paragraph"><p>To do so, start by downloading psexec and placing in a directory of your choice,
we&#8217;ll call it AGENT_DIRECTORY here. Store the version of the agent you want to
download to the same directory.</p></div>
<div class="paragraph"><p>Once you have both, you have to make sure you know the username and password of
an Administrator user in the remote system. Once all these requirements are met,
just start a cmd.exe shell and type:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd C:\AGENT_DIRECTORY\
net use \\MACHINE\IPC$ /USER:USERNAME *
psexec \\MACHINE -c -f -s agent-version.exe</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><p>The NET USE command will ask for a password interactively, so it&#8217;s not suited
for using in scripts. You could Switch the <em>*</em> for the PASSWORD instead if you
want to include it in a script.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>You&#8217;ll need to replace:</p></div>
<div class="ulist"><ul>
<li>
<p>
C:\AGENT_DIRECTORY\ with the full path you chose.
</p>
</li>
<li>
<p>
MACHINE with the name of the target system.
</p>
</li>
<li>
<p>
USERNAME with the user with administrative privileges on the target system.
</p>
</li>
</ul></div>
<div class="paragraph"><p>This will copy the agent-version.exe executable on the target system and execute
it. The installation doesn&#8217;t require user input.</p></div>
<div class="paragraph"><p>The expected output is something along these lines:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>C:\&gt; cd C:\AGENT_DIRECTORY\
C:\&gt; net use \\127.0.0.1\IPC$ /USER:admin *
Type the password for \\127.0.0.1\IPC$:
The command completed successfully

C:\AGENT_DIRECTORY&gt; psexec \\127.0.0.1 -c -f -s agent.exe
PsExec v1.98 - Execute processes remotely
Copyright (C) 2001-2010 Mark Russinovich
Sysinternals - www.sysinternals.com

The command completed successfully.

agent.exe exited on 127.0.0.1 with error code 0.

C:\AGENT_DIRECTORY&gt;</code></pre>
</div></div>
<div class="paragraph"><p>For even less footprint on installation you could host the agent on a shared
folder on the network and use this psexec command instead:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd C:\AGENT_DIRECTORY\
net use \\MACHINE\IPC$ /USER:USERNAME *
psexec \\MACHINE -s \\SHARE\FOLDER\agent-version.exe</code></pre>
</div></div>
<div class="paragraph"><p>This requires the USERNAME on the remote MACHINE be able to log into SHARE and
access the shared folder FOLDER. You can do this either by explicitly allowing
the user USERNAME on that share or by using an Anonymous share.</p></div>
<div class="paragraph"><p>The best way to verify whether the whole installation process has worked is to
<a href="#_searching_for_a_client">search for the client in the GUI</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_linux_macos_x_deployment">Linux / MacOS X deployment</h4>
<div class="paragraph"><p>On linux, the process depends on your environment, if you have a mechanism such
as puppet, then building as a Deb package and deploying that way makes the most
sense.
Alternatively you can deploy using ssh:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>scp agent_version.deb host:/tmp/
ssh host sudo dpkg -i /tmp/agent_version.deb</code></pre>
</div></div>
<div class="paragraph"><p>On MacOS X, the same process applies, use puppet or equivalent if you have, or
use ssh.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_at_scale">Deploying at scale</h3>
<div class="paragraph"><p>There shouldn&#8217;t be any special considerations for deploying GRR clients at
scale. If the server can&#8217;t handle the load, the clients should happily back off
and wait their turn. However, we recommend a staged rollout if possible.</p></div>
</div>
<div class="sect2">
<h3 id="_debugging_the_agent_install">Debugging the Agent Install</h3>
<div class="paragraph"><p>If the installer is failing to run, it should output a log file which will help
you debug. The location of the logfile is configurable, but by default should
be:</p></div>
<div class="ulist"><ul>
<li>
<p>
Windows: %WinDir%\system32\logfiles\GRR_installer.txt
</p>
</li>
<li>
<p>
Linux/Mac OSX: /tmp/grr_installer.txt
</p>
</li>
</ul></div>
<div class="paragraph"><p>To make debugging easier, we also support repacking the client with verbosity
enabled. This is particularly handy on Windows. To repack with this enabled, on
the server you can do:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>db@host:~ sudo grr_config_updater --verbose -p ClientBuilder.console=True
repack_clients</code></pre>
</div></div>
<div class="paragraph"><p>Alternatively, you can set ClientBuilder.console: False inside your server
config file to have this setting always applied.</p></div>
<div class="paragraph"><p>Once you have done this, you can download the new binary from the Web UI. It
should have the same configuration, but will output detailed progress to the
console, making it much easier to debug.</p></div>
<div class="paragraph"><p>Note that the binary is also a zipfile, you can open it in any capable zip
reader. Unfortunately this doesn&#8217;t include the built in Windows zip file handler
but does include winzip or 7-zip. Opening the zip is useful for reading the
config or checking that the right dependencies have been included.</p></div>
<div class="paragraph"><p>Repacking the Windows client in verbose mode enables console output for both the
installer and for the application itself. It does so by updating the header of
the binary at PE_HEADER_OFFSET + 0x5c from value 2 to 3. This is at 0x144 on 64
bit and 0x134 on 32 bit Windows binaries. You can do this manually with a hex
editor as well.</p></div>
<div class="sect3">
<h4 id="_interactively_debugging_the_client">Interactively Debugging the Client</h4>
<div class="paragraph"><p>On each platform, the agent binary should support the following options:
--verbose::
  This will set higher logging allowing you to see what is going on.
--debug::
  If set, and an unhandled error occurs in the client, the client will break
  into a pdb debugging shell.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>C:\Windows\system32&gt;net stop "grr monitor"
The GRR Monitor service is stopping.
The GRR Monitor service was stopped successfully.

C:\Windows\system32&gt;c:\windows\system32\grr\2.5.0.5\grr.exe --config grr.exe.yaml --verbose</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>test@test0:~$ sudo service grr-single-server stop
[sudo] password for test:
grr-single-server stop/waiting
test@test0:~$ sudo /usr/sbin/grrd --config=/usr/lib/grr/grr_2.9.1.1_amd64/grr.yaml --verbose
INFO:2013-10-02 14:32:07,756 logging:1611] Starting GRR Prelogging buffer.
INFO:2013-10-02 14:32:07,791 logging:1611] Loading configuration from /usr/lib/grr/grr_2.9.1.1_amd64/grr.yaml</code></pre>
</div></div>
<div class="sect4">
<h5 id="_configuration_changes_to_ease_debugging">Configuration Changes to Ease Debugging</h5>
<div class="paragraph"><p>If you are finding that it is slow to debug because the agent starts backed
off to 10 minutes and you have to wait, you should change the configuration.
In windows, set the registry key poll_max to 10, then restart the service. You
can do this with regedit or via the Windows command line:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>C:\Windows\system32&gt;reg add HKLM\Software\GRR /v Client.poll_max /d 10
The operation completed successfully.

C:\Windows\system32&gt;net stop "grr monitor"
The GRR Monitor service is stopping.
The GRR Monitor service was stopped successfully.

C:\Windows\system32&gt;net start "grr monitor"
The GRR Monitor service is starting.
The GRR Monitor service was started successfully.</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_changing_logging_for_debugging">Changing Logging For Debugging</h5>
<div class="paragraph"><p>On all platforms, by default only hard errors are logged. A hard error is
defined as anything level ERROR or above, which is generally reserved for
unrecoverable errors. But because temporary disconnections are normal, an agent
failing to talk to the server doesn&#8217;t actually count as a hard error.</p></div>
<div class="paragraph"><p>In the client you will likely want to set:
Logging.verbose: True</p></div>
<div class="paragraph"><p>And depending on your configuration, you can play with syslog, log file and
Windows EventLog logging using parameters Logging.path, and Logging.engines.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uninstalling_the_agent">Uninstalling the Agent</h3>
<div class="paragraph"><p>On Windows the agent does not have a standard uninstaller. It is designed to
have minimal impact on the system and leave limited traces of itself such that
it can be hidden reasonably easily. Thus it was designed to install silently
without an uninstall.</p></div>
<div class="paragraph"><p>Disabling the service can be done with the Uninstall flow, but this does not
clean up after itself by default.</p></div>
<div class="paragraph"><p>Cleaning up the agent is a matter of deleting the service and the install
directory, then optionally removing the registry keys and install log if one
was created, as per below:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>sc stop "grr monitor"
sc delete "grr monitor"
reg delete HKLM\Software\GRR
rmdir /Q /S c:\windows\system32\grr
del /F c:\windows\system32\grr_installer.txt</code></pre>
</div></div>
<div class="paragraph"><p>On OSX you can also use the Uninstall flow.</p></div>
<div class="paragraph"><p>On Linux the standard system packaging (deb, pkg) is used by default. Use the
standard uninstall mechanisms for this.</p></div>
</div>
<div class="sect2">
<h3 id="_proxies_and_connectivity">Proxies and Connectivity</h3>
<div class="paragraph"><p>If an agent can&#8217;t connect to the server, there can be a number of reasons such
as:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Server Isn&#8217;t Listening
</dt>
<dd>
<p>
Confirm you can connect to the server and retrieve the server.pem file. E.g.
  <code>wget http://server:8080/server.pem</code>
</p>
</dd>
<dt class="hdlist1">
Proxy Required For Access
</dt>
<dd>
<p>
If the environment doesn&#8217;t allow direct connections GRR may need to use a
proxy. GRR currently doesn&#8217;t support Proxy Autoconfig or Proxy Authentication.
GRR will attempt to guess your proxy configuration, or you can explicitly set
proxies in the config file, e.g.
  <code>Client.proxy_servers: ["http://cache.example.com:3128/"]</code>
On Windows systems GRR will try a direct connection, and then search for
configured proxies in all users profiles on the system trying to get a working
connection.
On Linux GRR should obey system proxy settings, and it will also obey
environment variables. e.g.
  <code>export http_proxy=http://cache.example.com:3128</code>
</p>
</dd>
<dt class="hdlist1">
Outbound Firewall Blocking Connections
</dt>
<dd>
<p>
GRR doesn&#8217;t do anything to bypass egress firewalling by default. However, if you
have a restrictive policy you could add this as an installer plugin.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>If you look at the running config, the first time the client successfully
connects to the server a variable <code>Client.server_serial_number</code> will be written
to the config. If that exists, the client successfully made a connection.</p></div>
</div>
<div class="sect2">
<h3 id="_importing_the_nsrl">Importing the NSRL</h3>
<div class="paragraph"><p>The National Software Registry List (NSRL) is a collection of known software managed by NIST. It is commonly used in forensics to reduce the scope of analysis of already known software. This is typically done by whitelisting anything on the NSRL by hash.</p></div>
<div class="paragraph"><p>GRR has the ability to import the NSRL. This function prepopulates the GRR datastore with all known hashes and reduces the need for GRR to collect these from the client systems. This can be done by downloading the latest quarterly release of the NSRL from <a href="http://www.nsrl.nist.gov/Downloads.htm#isos">NIST</a>.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download NSRL from NIST
</p>
</li>
<li>
<p>
Expand the zipped file containing hashes
</p>
</li>
<li>
<p>
Run "import_nsrl_hashes.py" with the appropriate configuration options
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content">
<pre><code>~/grr/tools# python import_nsrl_hashes.py --config /etc/grr/grr-server.yaml --filename /media/&lt;path to expanded NSRL&gt;/NSRLFile.txt
Imported 5000 hashes
Imported 10000 hashes
Imported 15000 hashes
Imported 20000 hashes
Imported 25000 hashes</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_grr_gui">The GRR GUI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_grr_ui_modes">GRR UI Modes</h3>
<div class="paragraph"><p>GRR has a number of UI modes users can choose from by clicking on the cog in the top right. The TL;DR is you always want BASIC.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>BASIC</strong>: This mode should probably be called normal. You almost always want this. If you&#8217;re new to GRR you definitely <strong>only</strong> want this.
</p>
</li>
<li>
<p>
<strong>ADVANCED</strong>: This should probably be called developer. Lots of internal flows are exposed to help dev/test, experimental functionality is available, etc. Here be dragons.
</p>
</li>
<li>
<p>
<strong>DEBUG and "Canary mode"</strong>: As a user you probably never want these. Even as a developer you&#8217;ll only use them in very specific circumstances.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_searching_for_a_client">Searching For A Client</h3>
<div class="paragraph"><p>In order to start interfacing with a client, we first need to search for it in
the GUI. The GRR search bar is located at the top of the GUI and allows you to
search clients based on:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Hostname:</strong> "host:myhost-name"
</p>
</li>
<li>
<p>
<strong>Fully Qualified Domain Name (FQDN):</strong> "fqdn:myhost-name.organization.com", also prefixes of components, e.g. "fqdn:myhost-name.organization"
</p>
</li>
<li>
<p>
<strong>MAC address:</strong> "mac:eeffaabbccdd".
</p>
</li>
<li>
<p>
<strong>IP address:</strong> "ip:10.10.10.10", also prefixes of bytes "ip:10.10". Note that IP address is only collected during interrogate, which by default is run once per week.
</p>
</li>
<li>
<p>
<strong>User:</strong> "user:john"
</p>
</li>
<li>
<p>
<strong>Label:</strong> "label:testmachines". Finds hosts with a particular GRR label.
</p>
</li>
<li>
<p>
<strong>Time of Last Data Update:</strong> Time ranges can be given using "start_date:" and "end_date:" prefixes. The data is interpreted as a human readable timestamp. Examples: start_date:2015, end_date:2018-01-01.
</p>
</li>
</ul></div>
<div class="paragraph"><p>All of these keywords also work without the type specifier, though with less precision. For example "johnsmith" is both a user name and a hostname name, it will match both.</p></div>
<div class="paragraph"><p>Furthermore there are additional keywords such as OS and OS version. So "Windows" will find all windows machines and "6.1.7601SP1" will match Windows 7 machines with SP1 installed, "6.1.7601" will match those without a service pack.</p></div>
<div class="paragraph"><p><strong>By default, the search index only considers clients that have checked in during the last six months.</strong> To override this behavior, use an explicit "start_date:" directive as specified above.</p></div>
</div>
<div class="sect2">
<h3 id="_interpreting_client_search_results">Interpreting Client Search Results</h3>
<div class="paragraph"><p>Searching returns a list of clients with the following information about each one:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Online</strong>: An icon indicating whether the host is online or not. Green means
  online; yellow, offline for some time; red, offline for a long time.
</p>
</li>
<li>
<p>
<strong>Subject</strong>: The client IDentifier. This is how GRR refers internally to the
  system.
</p>
</li>
<li>
<p>
<strong>Host</strong>: The name of the host as the operating system sees it.
</p>
</li>
<li>
<p>
<strong>Version</strong>: The operating system version.
</p>
</li>
<li>
<p>
<strong>MAC</strong>: A list of MAC addresses of the system.
</p>
</li>
<li>
<p>
<strong>Usernames</strong>: A list of user accounts the operating system knows about (usually
  users local to the system or that have logged in).
</p>
</li>
<li>
<p>
<strong>First Seen</strong>: The time when the client first talked to the server.
</p>
</li>
<li>
<p>
<strong>OS install time</strong>: The timestamp for the operating system install.
</p>
</li>
<li>
<p>
<strong>Labels</strong>: Any labels applied to this client.
</p>
</li>
<li>
<p>
<strong>Last Checkin</strong>: The last time the client communicated with the server.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Once you&#8217;ve found the client you were looking for, click on it and both the left
panel and main panel will change to reflect you&#8217;re now working with a client.</p></div>
</div>
<div class="sect2">
<h3 id="_the_client_view">The client view</h3>
<div class="paragraph"><p>When interfacing with a client the left pane contains additional options. By
default, the Host information view will be active. It shows most of the
information that was available in the search results in an attribute-value. This
is because all of the information relative to the client is stored as an
attribute of it.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-client-mainview.png" alt="images/grr-gui-client-mainview.png" width="850" height="434" />
</div>
<div class="title">Figure 1. Client view</div>
</div>
<div class="paragraph"><p>GRR supports versioning of attributes. This means we store historical data of
each of attribute. Effectively, each attribute value stores both the value and
the time when this value was seen. When different values have been gathered over
time for a specific attribute, a <em>+</em> sign will appear before it in the GUI.
Click on it and it will display a table with all the known values over time.</p></div>
<div class="paragraph"><p>Additionally, in the listing view, the Age column has a clickable icon that
will show you the different versions of the file that have been collected.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-client-versionedmac.png" alt="images/grr-gui-client-versionedmac.png" width="850" height="466" />
</div>
<div class="title">Figure 2. Versioned MAC address</div>
</div>
</div>
<div class="sect2">
<h3 id="_listing_the_virtual_filesystem">Listing the Virtual FileSystem</h3>
<div class="paragraph"><p>One of the basic requirements any forensic analyst needs from its tools is to be
able to browse the target system&#8217;s filesystems. GRR allows you to do so but you
won&#8217;t find the remote filesystems prepopulated once you add a new client.</p></div>
<div class="paragraph"><p>First, let&#8217;s click the <em>Browse Virtual Filesystem</em> option on the left panel to
access this client&#8217;s VFS.</p></div>
<div class="paragraph"><p>As you can see, the main pane contains now 3 different subpanels:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>Tree view</em>. Located on the left side, the tree view presents a classical tree
  view of the client&#8217;s virtual filesystem.
</p>
</li>
<li>
<p>
<em>Table view</em>. The table view shows the contents of whichever node is selected
  on the tree view as a table, showing several (but not all) the attributes of
  objects contained within the selected node.
</p>
</li>
<li>
<p>
<em>Details view</em>. The bottom panel shows details about the node selected on the
  table view. It&#8217;s a tab based panel that allows to check the node in depth. One
  can see all its attributes, download its contents or see them in the browser
  either on a text based or hex-based view.
</p>
</li>
</ul></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-vfs-panels.png" alt="images/grr-gui-vfs-panels.png" width="850" height="476" />
</div>
<div class="title">Figure 3. GRR VFS Pane</div>
</div>
<div class="paragraph"><p>In order to check contents of the remote filesystem you first need to request a
directory listing. And before that you need to know which drive or volume you
want to list. You can find these under the <code>fs</code> (FileSystem) node of the tree
view.</p></div>
<div class="paragraph"><p>Inside you will find two directories:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<code>os</code> contains the volumes seen by the Operating System.
</p>
</li>
<li>
<p>
<code>tsk</code> contains volumes seen by sleuthkit when analyzing the partition table
on the remote system.
</p>
</li>
</ol></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-vfs-fs.png" alt="images/grr-gui-vfs-fs.png" width="850" height="200" />
</div>
<div class="title">Figure 4. GRR VFS fs node</div>
</div>
<div class="paragraph"><p>If you try to expand (just click) any of these volumes on a fresh system you
will see they are empty. To list its contents you just need to click on the
refresh button of the table view. This will ask the agent to obtain the
directory and send it back to the server.</p></div>
<div class="paragraph"><p>Wait just a few seconds and the table view will refresh itself and show the
contents.  Take into account the refresh button only requests a listing of the
current directory in a non-recursive manner.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-vfs-table-refresh.png" alt="images/grr-gui-vfs-table-refresh.png" width="850" height="474" />
</div>
<div class="title">Figure 5. GRR VFS Directory listing done</div>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><p>What just happened is that the GUI scheduled a Flow to list the directory.  The
agent received it and sent back messages with a list of entries. The frontend
servers picked up the responses and populated the datastore with an object for
each of them. These objects are AFF4 objects and holdsthe filesystem specific
attributes that we store (size on disk, dates, permissions) as attributes of
this object. These AFF4 objects form a hierarchical (tree-like) structure. We
map the filesystem hierarchy to the AFF4 hierarchy and the GUI simply shows you
this list of objects in a custom view, which is the table you&#8217;re seeing for the
VFS.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>The table view of the VFS shows a few columns by default:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>icon</em>. Shows whether this entry is a file or a directory.
</p>
</li>
<li>
<p>
<em>Name</em>. Contains the name of the file/directory entry.
</p>
</li>
<li>
<p>
<em>type</em>. The GRR object type assigned to this entry.
</p>
</li>
<li>
<p>
<em>size</em>. The object contents size in GRR. 0 in general because you&#8217;ve
  downloaded no content so far.
</p>
</li>
<li>
<p>
<em>stat.st_size</em>. The file/directory contents size on the remote filesystem.
</p>
</li>
<li>
<p>
<em>stat.st_mtime</em>. The file/directory last written time in UTC on the remote
  filesystem.
</p>
</li>
<li>
<p>
<em>stat.st_ctime</em>. The file/directory creation time in UTC on the remote
  filesystem..
</p>
</li>
<li>
<p>
<em>age</em>. The time at which all of this information was stored.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Now try clicking on any entry in the table view and the details view will
populate with data from this file.</p></div>
<div class="paragraph"><p>The details view has four tabs you can use. The default one is <code>Stats</code> and it
shows all the attributes for the selected node. It should look familiar to you
as it&#8217;s pretty much as the <code>Host Information</code> page you see where you can find
information about the client object.</p></div>
<div class="paragraph"><p>The rest are discussed in the next section.</p></div>
</div>
<div class="sect2">
<h3 id="_downloading_files">Downloading Files</h3>
<div class="paragraph"><p>The easiest way to download a file is through the GUI. To do so, you first have
to list the directory it&#8217;s in and browse there with the GUI.</p></div>
<div class="paragraph"><p>Select the file on the table panel and click the <em>Download</em> tab on the details
view. By clicking on <em>Get new version</em> you will issue a Flow to download the
given file. The client will transfer the given file by creating messages with
the file contents and it will be stored in the GRR datastore.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-vfs-download.png" alt="images/grr-gui-vfs-download.png" width="750" height="212" />
</div>
<div class="title">Figure 6. Download tab</div>
</div>
<div class="paragraph"><p>Once the file is downloaded, a new button will appear in this view above the
<em>Get new version</em> button called <em>Download</em>. As you guessed, this allows you to
download the file from the GRR datastore to your computer.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-vfs-downloaded.png" alt="images/grr-gui-vfs-downloaded.png" width="755" height="235" />
</div>
<div class="title">Figure 7. Downloaded file</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_versions">File Versions</h3>
<div class="paragraph"><p>One interesting property of GRR that may not be immediately obvious, is that
every object is versioned with it&#8217;s age, and for the most part, we keep old
versions instead of overwriting them. This means that if you Schedule listing of
a directory once a day, you will end up with a historical daily record of that
directory. You can click on the icon in the Age column to show a list of all
the versions of a file we have collected.</p></div>
<div class="paragraph"><p>In some cases, different versions of the object may have different types
depending on how it was retrieved. A common case of this is for files. If you
list a directory, the file entry will be a Stat, but if you download the same
file, you will get a HashImage.</p></div>
<div class="paragraph"><p>This can lead to confusion. If you download a file, then list the directory,
the downloadable HashImage may seem to disappeared due to the default view only
showing latest version of the file. You will need to click the Age icon to
access the previous version.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/caution.png" alt="Caution" />
</td>
<td class="content">
<div class="paragraph"><p>For safety reasons, GRR appends ".noexec" to the name of every file you request
to download to your computer.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_file_paths">Specifying File Paths</h2>
<div class="sectionbody">
<div class="paragraph"><p>Providing file names to flows is a core part of GRR, and many flows have been
consolidated into the File Finder flow, which uses a glob+interpolation syntax.</p></div>
<div class="sect2">
<h3 id="_file_path_examples">File Path Examples</h3>
<div class="paragraph"><p>All executables or dlls in each user&#8217;s download directory:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>%%users.homedir%%\Downloads\*.{exe,dll}</code></pre>
</div></div>
<div class="paragraph"><p>All .evtx files found up to three directories under C:\Windows\System32\winevt:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>%%environ_systemroot%%\System32\winevt\**.evtx</code></pre>
</div></div>
<div class="paragraph"><p>"findme.txt" files in user homedirs, up to 10 directories deep:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>%%users.homedir%%/**10/findme.txt</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_file_paths_backslash_or_forward_slash">File Paths: backslash or forward slash?</h3>
<div class="paragraph"><p>Either forward "/home/me" or backslash "C:\Users\me" path specifications are
allowed for any target OS.  They will be converted to a common format
internally.  We recommend using whatever is normal for the target OS: (backslash
for Windows, fwdslash for OS X and Linux).</p></div>
</div>
<div class="sect2">
<h3 id="_file_path_interpolation">File Path Interpolation</h3>
<div class="paragraph"><p>GRR supports path interpolation from values in the artifact Knowledge Base.
Interpolated values are enclosed with %%, and may expand to multiple elements.
e.g.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>%%users.homedir%%</code></pre>
</div></div>
<div class="paragraph"><p>Might expand to the following paths on Windows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>C:\Users\alice, C:\Users\bob, C:\Users\eve</code></pre>
</div></div>
<div class="paragraph"><p>and on OS X:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/Users/alice, /Users/bob, /Users/eve</code></pre>
</div></div>
<div class="paragraph"><p>and on Linux:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/home/alice, /usr/local/home/bob, /home/local/eve</code></pre>
</div></div>
<div class="paragraph"><p>A full list of possible interpolation values can be found by typing %% in the
gui.  The canonical reference is the <a href="https://github.com/google/grr/blob/master/proto/knowledge_base.proto">proto/knowledge_base.proto</a> file, which also contains docstrings for each type.</p></div>
</div>
<div class="sect2">
<h3 id="_path_globbing">Path Globbing</h3>
<div class="paragraph"><p>Curly braces work similarly to bash, e.g:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{one,two}.{txt,doc}</code></pre>
</div></div>
<div class="paragraph"><p>Will match: one.txt, two.txt, one.doc, two.doc</p></div>
<div class="paragraph"><p>Recursive searching of a directory is performed with **.  The default search
depth is 3 directories.  So:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/root/**.doc</code></pre>
</div></div>
<div class="paragraph"><p>Will match:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/root/blah.doc
/root/1/something.doc
/root/1/2/other.doc
/root/1/2/3/another.doc</code></pre>
</div></div>
<div class="paragraph"><p>More depth can be specified by adding a number to the **, e.g. this performs
the same search 10 levels deep:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/root/**10.doc</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_windows_registry_paths">Specifying Windows Registry Paths</h2>
<div class="sectionbody">
<div class="paragraph"><p>When specifying registry paths, GRR uses the following hive names (these can also be found by looking at the registry folder under "Browse Virtual Filesystem"):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HKEY_CLASSES_ROOT
HKEY_CURRENT_CONFIG
HKEY_CURRENT_USER
HKEY_DYN_DATA
HKEY_LOCAL_MACHINE
HKEY_PERFORMANCE_DATA
HKEY_USERS</code></pre>
</div></div>
<div class="paragraph"><p>The Registry Finder flow uses the same <a href="#path-globbing">path globbing</a> and <a href="#file-path-interpolation">interpolation system</a> as described above.  Examples:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Run\*
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce\*</code></pre>
</div></div>
<div class="paragraph"><p>RegistryFinder will retrieve the values of any keys specified and report them in the registry data field.  Default values will be retrieved and reported in registry data of the parent key.  E.g. for this registry structure:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>HKEY_LOCAL_MACHINE\Software\test:
(Default) = "defaultdata"
subkey = "subkeydata"</code></pre>
</div></div>
<div class="paragraph"><p>Collecting this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>HKEY_LOCAL_MACHINE\Software\test\*</code></pre>
</div></div>
<div class="paragraph"><p>Will give results like:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Path:   /HKEY_LOCAL_MACHINE/SOFTWARE/test
Registry data:  defaultdata

Path:   /HKEY_LOCAL_MACHINE/SOFTWARE/test/subkey
Registry data:  subkeydata</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_grep_syntax">Grep Syntax</h2>
<div class="sectionbody">
<div class="paragraph"><p>A number of GRR flows (such as File Finder and Memory Collector) accept Grep
specifications, which are a powerful way to search file and memory contents.
There are two types of grep syntax: literal and regex.</p></div>
<div class="sect2">
<h3 id="_literal_matches">Literal Matches</h3>
<div class="paragraph"><p>Use this when you have a simple string to match, or want to match a byte string.
Here&#8217;s a simple string example (note no quotes required):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>allyourbase</code></pre>
</div></div>
<div class="paragraph"><p>And a byte string example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>MZ\x90\x00\x03\x00\x00\x00\x04\x00\x00\x00</code></pre>
</div></div>
<div class="paragraph"><p>To minimise the potential for errors we recommend using python to create byte
strings for you where possible, e.g.  the above byte string was created in
ipython like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>In [1]: content = open("test.exe","rb").read(12)

In [2]: content
Out[2]: 'MZ\x90\x00\x03\x00\x00\x00\x04\x00\x00\x00'</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_regex_matches">Regex Matches</h3>
<div class="paragraph"><p>Use this when you need more complex matching. The format is a regular python
regex (see <a href="http://docs.python.org/2/library/re.html">http://docs.python.org/2/library/re.html</a>) with the following switches
applied automatically:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>re.IGNORECASE | re.DOTALL | re.MULTILINE</code></pre>
</div></div>
<div class="paragraph"><p>An example regex is below. The entire match is reported, () groups are not
broken out separately.  Also note that 10 bytes before and after will be added
to any matches by default - use the Advanced menu to change this behavior:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Accepted [^ ]+ for [^ ]+ from [0-9.]+ port [0-9]+ ssh</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_advanced_options">Advanced Options</h3>
<div class="paragraph"><p>The default options under the <em>Advanced</em> menu should be fine for most
situations, but this is where you can specify byte offsets and lengths, and how
much context to retrieve around matches.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_virtual_filesystem">The Virtual Filesystem</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>TODO</em></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_flows">Flows</h2>
<div class="sectionbody">
<div class="paragraph"><p>When designing GRR, one of the main goals was achieving great scalability.  One
of the main resource hogs with the client-server model is that while a client is
active all resources that might have been needed on the server side to
communicate with it and do processing are held (think temporary buffers,
sockets, file descriptors&#8230;). Even when the client itself is doing operations
that take time such as heavy computations or waiting on I/O, resources are held
on the server.</p></div>
<div class="paragraph"><p>When trying to deal with thousands of clients at the same time, this would
translates into the server hoarding many unneeded resources.</p></div>
<div class="paragraph"><p>To solve the resource hogging problem, Flows were created. Flows are the
server-side code entities that call client actions. These calls are done
asynchronously. That is, they are requested and their results become available
later on. Flows are like a state machine, where transition between states
happens when the results of client actions return to the server. So here&#8217;s what
happens when the GRR server launches a typical Flow.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The GRR server executes the initial Flow state.
</p>
</li>
<li>
<p>
This state asks for one or more client actions to be performed on the client.
</p>
</li>
<li>
<p>
The server clears all the resources this Flow has requested and waits for
responses from the client to come back.
</p>
</li>
<li>
<p>
When responses are received, the server fetches all the needed resources
again and runs the Flow state where it expects these responses. If more client
actions are requested by this state it goes back to step 2. Otherwise&#8230;
</p>
</li>
<li>
<p>
The results of this Flow are stored and the flow state is updated.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Flows have a second very interesting property. For flows that make use of some
of the most primitive client actions, because all of the logic is encapsulated
on the server side and the client doesn&#8217;t have any state at all, they naturally
survive reboots while processing is taking place.</p></div>
<div class="paragraph"><p>Now, whether you&#8217;ve been following the <a href="#_getting-started"><em>Getting started</em></a>
chapter or not, as long as you have a client communicating with the server you
can already check some flows in the GUI. While having selected a client in the
GUI, click on the <em>Manage launched flows</em> link on the left panel.  This will
bring you to a view that shows all the Flows that have been requested on this
client.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-flows-main.png" alt="images/grr-gui-flows-main.png" width="850" height="252" />
</div>
<div class="title">Figure 8. Launched flows view</div>
</div>
<div class="paragraph"><p>The flows view resembles very much the VFS view. Indeed, the GUI reuses
table-detail panels on many of the views. The table view shows the current state
of the flow, what&#8217;s the flow identifier (<em>Path</em>), the name of the Flow launched,
the date when it was launched, when it was last active and who created it.</p></div>
<div class="paragraph"><p>As you can see, 4 Flows have been launched in the shown example:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<em>CAEnroler</em>. This is the first flow ever to launch for any client. It is the
enroling Flow which gets the client set up server side.
</p>
</li>
<li>
<p>
<em>Interrogate</em>. After enroling, a client sends some information about the
machine it&#8217;s running in such as the hostname, MAC address or users available
on the system. This is the flow that fetches this information and if you
remember the <em>Host Information</em> option, most information is contained there.
</p>
</li>
<li>
<p>
<em>ListDirectory</em>. A Flow that lists the contents of a directory. This is what
happened when the refresh button was pressed on the GUI.
</p>
</li>
<li>
<p>
<em>GetFile</em>. A flow to download a specific file on a client. This is the flow
that got launched when we asked to download a file through the GUI.
</p>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><p>The list of flows doesn&#8217;t auto-refresh at the moment. To see it updated you will
have to manually refresh it by clicking on the <em>Manage launched flows</em> option
again.</p></div>
<div class="paragraph"><p>Clicking on an individual flow to see its details, however, DOES get fresh
information from the datastore.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s see the <em>ListDirectory</em> flow in detail. You can click on any flow to get
detailed information.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="images/grr-gui-flows-listdirectory.png" alt="images/grr-gui-flows-listdirectory.png" width="842" height="519" />
</div>
<div class="title">Figure 9. ListDirectory flow details</div>
</div>
<div class="paragraph"><p>There&#8217;s a lot of information here. Again, all these values are attributes. The
most interesting bits are the flow <em>state</em>, which tells us whether it finished
correctly (oddly named <strong>TERMINATED</strong>) or not (<strong>ERROR</strong>), or if it&#8217;s still running
(<strong>RUNNING</strong>). The <em>args</em>, which are the specific arguments that were passed to
it. Finally, the <em>LOG</em> attribute holds a list of messages the Flow generated.</p></div>
<div class="sect2">
<h3 id="_launching_flows_manually">Launching flows manually</h3>
<div class="paragraph"><p>We&#8217;ve seen how Flows were created through the UI. Now, we are gonna issue our
own <em>ListDirectory</em> flow, giving it parameters and then you can check the
<a href="#_available-flows">available flows</a> list to decide what else you might want to
run on your client.</p></div>
<div class="paragraph"><p>To start a new Flow simply click on the <em>Start new flows</em> option on the left
panel. The main panel will populate with the holy trinity of panels. The tree
view shows all the Flows organized by category.</p></div>
<div class="paragraph"><p>Expand the <em>FileSystem</em> category and select the <em>ListDirectory</em> flow. The flow
view will populate with a form with all the user-configurable parameters for
every flow. What&#8217;s more, because each parameter has a well-defined type, GRR
shows you nice widgets to select a value for each of them.</p></div>
<div class="paragraph"><p>The ListDirectory flow accepts three parameters (the client ID is implicit in
the GUI):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<em>path</em>. This is the textual path that you want listed.
</p>
</li>
<li>
<p>
<em>pathtype</em>. Which VFS handler you want to use for the path. Available options
are:
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>OS</strong>. Uses the OS "open" facility. These are the most straightforward for a
    first user. Examples of <em>os</em> paths are <code>C:/Windows</code> on Windows or
    <code>/etc/init.d/</code> on Linux/OSX.
</p>
</li>
<li>
<p>
<strong>TSK</strong>. Use Sleuthkit. Because Sleuthkit is invoked a path to the device is
    needed along the actual directory path. Examples of <em>tsk</em> paths are
    <code>\\?\Volume{19b4a721-6e90-12d3-fa01-806e6f6e6963}\Windows</code> for Windows or
    <code>/dev/sda1/init.d/</code> on Linux. The specific path will vary from client to
    client.
</p>
</li>
<li>
<p>
<strong>REGISTRY</strong>. Windows-related. You can open the live Windows registry as if it
    was a virtual filesystem.a So you can specify a <em>path</em> such as
    <code>HKEY_LOCAL_MACHINE/Select/Current</code>.
</p>
</li>
<li>
<p>
<strong>MEMORY</strong>. Access the client memory.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<em>Priority</em>. Three thresholds are given to flows. The higher priority flows
take precedence executing over lower priority ones. By default all flows are
scheduled as Medium priority. In general, you shouldn&#8217;t change this parameter.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Once you&#8217;ve filled in each required field, click on <em>Launch</em> and if all
parameters validated, the Flow will run. Now you can go to the <em>Manage launched
flows</em> view to find it running or track it.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/important.png" alt="Important" />
</td>
<td class="content">
<div class="paragraph"><p>Not all flows might be available on every platform. When trying to run a flow
that&#8217;s not available in the given platform an error will show up.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_available_flows">Available flows</h3>
<div class="paragraph"><p>The easiest ways to see the current flows is to check in the AdminUI under
StartFlow. These have useful documentation.</p></div>
<div class="paragraph"><p>Note that by default only BASIC flows are shown in the Admin UI. By clicking
the settings (gear icon) in the top right, you can enable ADVANCED flows. With
this set you will see many of the underlying flows which sometimes be useful,
but require a deeper understanding of GRR.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hunting">Hunting</h2>
<div class="sectionbody">
<div class="paragraph"><p>Hunting is one of the key features of GRR. Anything you can do on a single
client, should be able to be done on thousands of clients just as easily.</p></div>
<div class="paragraph"><p>A hunt specifies a Flow, the Flow parameters, and a set of rules for which
machines to run the Flow on.</p></div>
<div class="sect2">
<h3 id="_creating_a_hunt">Creating a Hunt</h3>
<div class="paragraph"><p>You can create a new Hunt in the Hunt Manager section of the UI. To create a
Hunt:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Click the + button
</p>
</li>
<li>
<p>
Fill out the details of the flow you want to run
</p>
</li>
<li>
<p>
Set any output plugins, such as receiving an email for each result.
</p>
</li>
<li>
<p>
Set <a href="#hunt-parameters">Hunt Parameters</a>
</p>
</li>
<li>
<p>
Set <a href="#hunt-rules">Hunt Rules</a>. Most commonly this is used to select a specific platform target, e.g. Windows.
</p>
</li>
<li>
<p>
Click Run
</p>
</li>
</ol></div>
<div class="paragraph"><p>Unless approvals are required, the hunt should begin running immediately.</p></div>
<div class="sect3">
<h4 id="_hunt_parameters">Hunt Parameters</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Description - Description of the hunt
</p>
</li>
<li>
<p>
Client Limit - The maximum number of clients to run on (note this number
  is considered a soft limit for technical reasons, we may slightly overshoot)
</p>
</li>
<li>
<p>
Expiry Time - Stop queuing flows for new clients that appear after this
  amount of time.
</p>
</li>
<li>
<p>
Client rate - Number of clients to schedule the hunt on per minute. The default
  of 20 we have found to be safe, avoiding overloading the server for intensive
  hunts with lots of message passing (e.g. multiple flows, lots of results).  A
  value of 0 disables rate limiting and clients will be scheduled as fast as
  possible.  Use this with care: light hunts you need to run quickly.
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_hunt_rules">Hunt Rules</h4>
<div class="paragraph"><p>Hunt rules are most commonly used to target a particular platform simply by selecting the appropriate platform from the dropdown list.  Note that these rules are a logical AND, so specifying more than one OS condition is incorrect, since no machine will match the criteria for Windows AND Linux.  If you have a hunt that you want to target to some, but not all, OSes you currently need to create a hunt for each (or perhaps create an artifact with the appropriate OS criteria).</p></div>
<div class="paragraph"><p>Hunt rules can also be more complex, e.g. a regex match to ensure to check the that the Version attribute at / matches 2.5.2.*</p></div>
<div class="paragraph"><p>Regex rules are particularly useful when labels are built into deployed clients via the Client.labels config option, so that you can have different deployments that share a server but can be targeted separately in a hunt.  To hunt clients with a particular label use a Regular Expression rule for the Label attribute at path "/" with a regex matching the client label text.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_hunts">Controlling Hunts</h3>
<div class="sect3">
<h4 id="_create_a_new_hunt">Create a new hunt</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/new.png" alt="images/icons/new.png" />
</div>
</div>
<div class="paragraph"><p>Use this button to create a new hunt.</p></div>
</div>
<div class="sect3">
<h4 id="_start_a_hunt">Start a hunt</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/play_button.png" alt="images/icons/play_button.png" />
</div>
</div>
<div class="paragraph"><p>Use this button to start a newly created hunt. New hunts are created in the PAUSED state, so you&#8217;ll need to do this to run them.  Hunts that reach their client limit will also be set to PAUSED, use this button to restart them after you have removed the client limit (see modify below).</p></div>
</div>
<div class="sect3">
<h4 id="_stop_a_hunt">Stop a hunt</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/stop_button.png" alt="images/icons/stop_button.png" />
</div>
</div>
<div class="paragraph"><p>Stopping a hunt will prevent new clients from being scheduled and interrupt in-progress flows the next time they change state.  This is a hard stop, so in-progress results will be lost, but results already reported are unaffected.  If you restart a hunt after stopping it, the hunt will be scheduled on <strong>all</strong> clients again, including those on which it has already run.  There isn&#8217;t a reliable way to recover from the interrupted processing, so we restart the hunt on all clients as if it were new.  This button replaces the old pause button, and more accurately reflects the action being taken.</p></div>
</div>
<div class="sect3">
<h4 id="_modify_a_hunt">Modify a hunt</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/modify.png" alt="images/icons/modify.png" />
</div>
</div>
<div class="paragraph"><p>The modify button allows you to change the hunt client limit and the hunt expiry time.  Typically you use this to remove a client limit (set it to 0) to let the hunt run on all machines.  Modifying an existing hunt doesn&#8217;t require re-approval.  Hunts can only be modified in the STOPPED or PAUSED states.</p></div>
</div>
<div class="sect3">
<h4 id="_delete_a_hunt">Delete a hunt</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/editdelete.png" alt="images/icons/editdelete.png" />
</div>
</div>
<div class="paragraph"><p>Use this to remove an unwanted hunt.  For accountability reasons hunts can only be deleted if they haven&#8217;t run on clients.</p></div>
</div>
<div class="sect3">
<h4 id="_show_automated_hunts">Show automated hunts</h4>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/icons/robot.png" alt="images/icons/robot.png" />
</div>
</div>
<div class="paragraph"><p>Use this button to display all hunts, including those created by cronjobs.  These are hidden by default to reduce UI clutter.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_why_is_my_hunt_doing_nothing">Why Is My Hunt Doing Nothing?</h3>
<div class="ulist"><ul>
<li>
<p>
There are caches involved in the frontend server, you may need to wait a
couple of minutes before the first client picks up the flow.
</p>
</li>
<li>
<p>
Clients only check if there is hunt work to do when doing a foreman check.
The frequency of these checks are specified in the <code>Client.foreman_check_frequency</code>
parameter. This should default to every 10 minutes as of version 0.2-9.
</p>
</li>
<li>
<p>
Even when a client issues a foreman check, the flows may not immediately start.
Instead, the process is asynchronous, so the check tells the server to check its
hunt rules to see if there are things for the client to do. If there are, it
schedules them, but the client may not do its regular poll and pick up that flow
until <code>Client.poll_max period</code> (10 minutes by default).
</p>
</li>
<li>
<p>
When you run a hunt you can specify a "Client Rate" as specified
above. If this is set low (but not 0), you can expect a slow hunt.
</p>
</li>
<li>
<p>
When running a hunt under high server load, clients seem appear complete in
batches. This results in the completion graph appearing "stepped". The clients are
finishing normally, but their results are being processed and logged in batches by
the Hunt. When the system is under load, this hunt processing takes some time to
complete resulting in the <em>steps</em>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exporting_data_from_grr">Exporting Data From GRR</h2>
<div class="sectionbody">
<div class="paragraph"><p>Extracting bulk data from the GRR datastore using the UI is slow and cumbersome.
It is possible to use the console to extract any data you wish, but we also
provide a tool called grr_export, and a FUSE layer.</p></div>
<div class="sect2">
<h3 id="_exporting_a_single_file">Exporting a Single File</h3>
<div class="listingblock">
<div class="content">
<pre><code>db@grrhost: ~$ grr_export file --path=aff4:/C.123456890ABCDEF/fs/os/boot.ini --output=/tmp
Using configuration &lt;ConfigFileParser filename="/etc/grr/grr-server.conf"&gt;
Downloading: aff4:/C.123456890abcdef/fs/os/boot.ini to: /tmp/C.123456890abcdef/fs/os/boot.ini

db@grrhost: ~$</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_exporting_a_directory">Exporting a Directory</h3>
<div class="paragraph"><p>Directories can be exported recursively</p></div>
<div class="listingblock">
<div class="content">
<pre><code>db@grrhost: ~$ grr_export file --path=aff4:/C.123456890ABCDEF/fs/os/ --output=/tmp --overwrite --depth=4
Downloading: aff4:/C.123456890abcdef/fs/os/boot.ini to: /tmp/C.123456890abcdef/fs/os/boot.ini
Downloading: aff4:/C.123456890abcdef/fs/os/tmp1 to: /tmp/C.123456890abcdef/fs/os/tmp1

db@grrhost: ~$</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_exporting_a_collection">Exporting a Collection</h3>
<div class="paragraph"><p>An RDFValueCollection is a collection of objects, often URNs or StatEntry
objects which reference files that have been downloaded. These are often created
as the output of hunts and it is common to want to download all these files to
disk so you can work with them easily.</p></div>
<div class="paragraph"><p>You need to pass in a URN, and we will download files from the collection to the
directory you specify with --output.</p></div>
<div class="paragraph"><p>In addition, for collections, you can requests a dump a yaml file of the client data to
the root of the client directory, e.g. C.123456890abcdef/client_info.yaml.
This is useful for identifying which machine the files came from when working on
the filesystem.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>db@grrhost: ~$ grr_export collection_files --path=aff4:/hunts/W:123456/Results --output=/tmp --dump_client_info</code></pre>
</div></div>
<div class="paragraph"><p>There are also additional plugins for export that handle different output types. E.g.
using "collection" you dump data to a flattened csv format, see:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>grr_export --help
grr_export collection --help    # Help on the specific command</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_console">The Console</h2>
<div class="sectionbody">
<div class="paragraph"><p>The GRR console <code>grr_console</code> gives you an interactive ipython shell with all
the right imports to do pretty much whatever you want.</p></div>
<div class="sect2">
<h3 id="_running_a_simple_flow_list_processes">Running a Simple Flow - List Processes</h3>
<div class="paragraph"><p>Run the ListProcesses flow and look at the output.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">
<div class="paragraph"><p>"C.93ce669b1b0c76b6" is the client you want to run the flow on (get it from the gui).</p></div>
</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="_access_tokens">Access tokens</h3>
<div class="paragraph"><p>If you have configured GRR to only allow access when granted, you&#8217;ll need an access token for any action on a client.</p></div>
<div class="paragraph"><p>To create an access (or ACL) token:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>token = access_control.ACLToken(username="Me", reason="Why")</code></pre>
</div></div>
<div class="paragraph"><p>Note the reason must be the same as in the initial approval request, otherwise the access token is not granted.</p></div>
<div class="paragraph"><p>The access token then must be passed to e.g. client related console actions, like opening a file/directory:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file_object = aff4.FACTORY.Open("aff4:/" + client_id + "/fs/tsk/c:/MyFile.txt", token=token)</code></pre>
</div></div>
<div class="paragraph"><p>It is also possible to have the console automatically generate the access token on start up. For this the client needs to be specified when starting the console script, e.g.:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>grr_console --client=C.0000000000000000</code></pre>
</div></div>
<div class="paragraph"><p>If a valid access token is available the following variables will be set:
  * client
  * token</p></div>
<div class="paragraph"><p>To check the token:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>print token.reason</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>Why</code></pre>
</div></div>
<div class="paragraph"><p>Or to check the client:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>print client.client_id</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>aff4:/C.0000000000000000</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_requesting_approval">Requesting approval</h3>
<div class="paragraph"><p>To request an approval via the console run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>ApprovalRequest(client_id, reason, approvers, token=None)</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_granting_approval">Granting approval</h3>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_to_grant_approval_via_the_console_run">To grant approval via the console run:</h2>
<div class="sectionbody">
<div class="paragraph"><p>ApprovalGrant(token=token)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Listing and searching clients
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To list (or search) all clients:</code></pre>
</div></div>
<div class="paragraph"><p>search_query = ".*"
list_of_clients = SearchClients(search_query)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>To list (or search) a specific client:</code></pre>
</div></div>
<div class="paragraph"><p>search_query = "host:test"
list_of_clients = SearchClients(search_query)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>You can also use the client identifier e.g. "C.000000000000000"

The SearchClients function will return a list of tuples containing:

 - a VFSGRRClient object;
 - the last known hostname of the client;
 - the last known IP address of the client;
 - the last check-in date and time.

Retrieving the last known hostnames for a list of client identifiers
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre>
</div></div>
<div class="paragraph"><p># A text file containing one client identifier per line.
filename = "clients.txt"
file_object = open(filename, mode="rb")
for client_id in file_object.readlines():
    client_id = client_id.strip()
    client_objects = SearchClients(client_id)
    for _, hostname, _, _ in client_objects:
        print "{0:s}\t{1:s}".format(client_id, hostname)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Delete a client and all of its data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre>
</div></div>
<div class="paragraph"><p>aff4.FACTORY.Delete(rdf_client.ClientURN(client_id))</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Read a specific version of a file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</code></pre>
</div></div>
<div class="paragraph"><p>fd = aff4.FACTORY.Open(path, token=token, age=aff4.ALL_TIMES)
# list all the versions of the file
for x in fd.GetValuesForAttribute(fd.Schema.TYPE):
    print (x.value, x.age.value, str(x.age))
fd2 = aff4.FACTORY.Open(path, token=token, age=1335957983819287)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Artifacts</code></pre>
</div></div>
<div class="paragraph"><p>During a security investigation responders need to quickly retrieve common
pieces of information that include items such as logs, configured services, cron
jobs, patch state, user accounts, and much more.  These pieces of information
are known as forensic artifacts, and their location and format vary drastically
across systems.</p></div>
<div class="paragraph"><p>We have built a framework to describe forensic artifacts that allows them to be collected and customised quickly using GRR.  This collection was initially contained inside the GRR repository, but we have now moved it out to <a href="https://github.com/ForensicArtifacts/artifacts">a separate repository</a> to make access simple for other tools.</p></div>
<div class="paragraph"><p>The goals of the GRR artifacts implementation are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Describe artifacts with enough precision that they can be collected
    automatically without user input.
</p>
</li>
<li>
<p>
Cover modern versions of Mac, Windows, and Linux and common software
    products of interest for forensics.
</p>
</li>
<li>
<p>
Provide a standard variable interpolation scheme that allows artifacts to
    simply specify concepts like "all user home directories", %TEMP%,
    %SYSTEMROOT% etc.
</p>
</li>
<li>
<p>
Allow grouping across operating systems and products e.g. "Chrome
    Webhistory" artifact knows where the web history is for Chrome on
    Mac/Win/Linux.
</p>
</li>
<li>
<p>
Allow grouping of artifacts into high level concepts like "Persistence
    Mechanisms", and investigation specific meta-artifacts.
</p>
</li>
<li>
<p>
To create simple, shareable, non-grr-specific human-readable definitions
    that allow people unfamiliar with the system to create new artifacts. i.e.
    not XML or a domain specific language.
</p>
</li>
<li>
<p>
The ability to write new artifacts, upload them to GRR and be able to
    collect them immediately.
</p>
</li>
</ul></div>
<div class="paragraph"><p>GRR artifacts are defined in YAML, with a style guide
<a href="https://github.com/ForensicArtifacts/artifacts/blob/master/docs/Artifacts%20definition%20format%20and%20style%20guide.asciidoc">available here</a>.  We use a standard set of machine information collected from the host for variable interpolation.  This collection
of data is called the Knowledge Base (see <a href="https://github.com/google/grr/blob/master/grr/proto/knowledge_base.proto">proto/knowledge_base.proto</a>)
and is referenced with a %%variable%% syntax.</p></div>
<div class="paragraph"><p>The artifact defines where the data lives.  Once it is retrieved by GRR a
<a href="https://github.com/google/grr/tree/master/grr/parsers">parser</a> can optionally
be applied to turn the collected information into a more useful format, such as
parsing a browser history file to produce URLs.</p></div>
<div class="sect2">
<h3 id="_collecting_artifacts">Collecting Artifacts</h3>
<div class="paragraph"><p>Artifacts can be collected using the artifact collector flow.  Multiple
artifacts can be collected at once.  Using artifacts in hunts is particularly
powerful as an artifact like JavaCacheFiles can be scheduled in a single hunt
across all three operating systems, and the artifact itself determines the
correct paths to be downloaded for each OS.</p></div>
</div>
<div class="sect2">
<h3 id="_defining_new_artifacts">Defining New Artifacts</h3>
<div class="paragraph"><p>New artifacts should be added to the <a href="https://github.com/ForensicArtifacts/artifacts/tree/master/data">forensic artifacts repository</a>.  The changes can be imported into grr by running <strong>make</strong> in the <strong>grr/artifacts</strong> directory.  This will delete the existing artifacts, checkout the latest version of the artifact repository, and add all of the yaml definitions into GRR&#8217;s directory.  Running <strong>python setup.py build</strong> will have the same effect.  The new artifacts will be available once the server is restarted.</p></div>
<div class="paragraph"><p>Artifacts can also be uploaded via the Artifact Manager gui and used immediately without the need for a restart.  When developing a new artifact you can use the <strong>grr/artifacts/local</strong> directory as a temporary home for testing (see next section).</p></div>
</div>
<div class="sect2">
<h3 id="_private_artifacts">Private Artifacts</h3>
<div class="paragraph"><p>Artifacts that are specific to your environment or need to remain private can be added to the <strong>grr/artifacts/local</strong> directory.  This directory will remain untouched when you update the main artifacts repository.  You can also use this directory to test new artifacts before they are added to the main public repository.</p></div>
</div>
<div class="sect2">
<h3 id="_grr_specific_artifacts_aka_flow_templates">GRR-Specific Artifacts aka "Flow Templates"</h3>
<div class="paragraph"><p>We currently support using the artifact format to call GRR-specific functionality, such as invoking a GRR client action, listing processes or running a rekall plugin.  These "artifacts" are grr-specific so they remain in the GRR repository under <strong>artifacts/flow_templates</strong>, which is a temporary working name.  We intend to rework this functionality into a more general, powerful, and configurable way to call GRR from YAML.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grr_8217_s_fuse_layer">GRR&#8217;s FUSE layer</h2>
<div class="sectionbody">
<div class="paragraph"><p>GRR&#8217;s FUSE layer allows you to mount remote filesystems at directories in your
machine. Run it by running <code>grr_fuse</code>. For configuration options, see
grr/tools/fuse_mount.py</p></div>
<div class="paragraph"><p>By default <code>grr_fuse</code> will mount the root AFF4 directory, so you&#8217;ll be able to
cd into any client from there. It&#8217;s also possible to mount at arbitrary URNs
using the --aff4_path flag to fuse_mount.py.</p></div>
<div class="paragraph"><p>Example invocation:
<code>grr_fuse</code> --mountpoint=/mnt/aff4</p></div>
<div class="paragraph"><p>While using the FUSE layer, flows will be run on the client to update
files/directories, so some commands (e.g. ls) might be slow the first time they
are run. Results are cached so that subsequent calls (e.g. in tab completion) do
not need to make a request to the client. The cache is time based, so any files
older than the expiry time will be refreshed from the client. The default cache
time is 5 minutes, and can be set with the --max_age_before_refresh flag in
grr/tools/fuse_mount.py</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_timeline">Timeline</h2>
<div class="sectionbody">
<div class="paragraph"><p>GRR currently contains rudimentary support for timelining and timeline
visualization through the MACTimes flow. When you run this flow it will be
executed server side and will create a timeline collection containing all
events that you specified in the flow.</p></div>
<div class="paragraph"><p>If you view the results from this flow, you will see a GRRTimeSeries, which
when selected should give you a link to View Details. Clicking on that link will
take you to the Timeline view.</p></div>
<div class="paragraph"><p>Within the timeline view you can download the timeline as a CSV file, or you
can also do basic filtering in the GUI. Filters work against the objects stored
as events in timeline.</p></div>
<div class="paragraph"><p>Below are some example filters that might be of use:</p></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Glossary</h2>
<div class="sectionbody">
<div class="sect4">
<h5 id="_aff4">AFF4</h5>
<div class="paragraph"><p>AFF4 is the data model used for storage in GRR, with some minor extensions. You
can read about the usage in the GRR paper linked above and there is additional
detail linked at <a href="http://www.forensicswiki.org/wiki/AFF4">http://www.forensicswiki.org/wiki/AFF4</a></p></div>
</div>
<div class="sect4">
<h5 id="_agent">Agent</h5>
<div class="paragraph"><p>A platform-specific program that is installed on machines that one might want to
investigate. It communicates with the GRR server and can perform client actions
at the server&#8217;s request.</p></div>
</div>
<div class="sect4">
<h5 id="_client">Client</h5>
<div class="paragraph"><p>A system that has an agent installed. Also used to refer to the specific
instance of an agent running in that system.</p></div>
</div>
<div class="sect4">
<h5 id="_client_action">Client Action</h5>
<div class="paragraph"><p>A client action is an action that a client can perform on behalf of the server.
It is the base unit of work on the client. Client actions are initiated by the
server through Flows.  Example client actions are ListDirectory,
EnumerateFilesystems, Uninstall.</p></div>
</div>
<div class="sect4">
<h5 id="_collection">Collection</h5>
<div class="paragraph"><p>A Collection is a logical set of objects stored in the AFF4 database. Generally
these are a list of URNs containing a grouping of data such as Artifacts or
Events from a client.</p></div>
</div>
<div class="sect4">
<h5 id="_datastore">DataStore</h5>
<div class="paragraph"><p>The backend is where all AFF4 and Scheduler data is stored. It is provided as an
abstraction to allow for replacement of the datastore without significant
rewrite. The datastore supports read, write, querying and filtering.</p></div>
</div>
<div class="sect4">
<h5 id="_flow">Flow</h5>
<div class="paragraph"><p>A logical collection of server or client actions which achieve a given
objective. A flow is the core unit of work in the GRR server. For example a
BrowserHistory flow contains all the logic to download, extract and display
browser history from a client. Flows can call other flows to get their job
done. E.g. A CollectBrowserHistory flow might call ListDirectory and GetFile to
do it&#8217;s work. A flow is implemented as a class that inherits from GRRFlow.</p></div>
</div>
<div class="sect4">
<h5 id="_frontend_server">Frontend server</h5>
<div class="paragraph"><p>Server-side component that sends and receives messages back and forth from
clients.</p></div>
</div>
<div class="sect4">
<h5 id="_hunt">Hunt</h5>
<div class="paragraph"><p>A Hunt is a mechanism for managing the execution of a flow on a large number of
machines. A hunt is normally used when you are searching for a specific piece of
data across a fleet of machines. Hunts allow for monitoring and reporting of
status.</p></div>
</div>
<div class="sect4">
<h5 id="_message">Message</h5>
<div class="paragraph"><p>Transfer unit in GRR that transports information from a Flow to a client and
viceversa.</p></div>
</div>
<div class="sect4">
<h5 id="_worker">Worker</h5>
<div class="paragraph"><p>Once receiving a message from a client a worker will wake up the Flow that
requested its results and execute it.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2017-12-05 15:46:18 UTC
</div>
</div>
</body>
</html>
