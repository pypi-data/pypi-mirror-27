{% load i18n l10n %}

{% get_current_language as LANGUAGE_CODE %}

<style type ="text/css" media="screen" >
	.button_xslx
	{
		padding: 3px 3px 2px 2px;
		float:right;
	}

	.download_xslx
	{
		/*padding: 3px 3px 2px 2px;*/
		/*border:1px solid green;*/
		display: inline-block;

	}

	.dropdown_btn_xlsx
	{
		margin-left: -1px !important;
	}

	.dropdown_opt_xlsx
	{
		position: absolute;
		z-index: 1;
	}

</style>


<div id='{{view_name}}_{{button_name}}_xlsx' class = 'button_xslx'>
	<div id='{{view_name}}_{{button_name}}_download' class = 'download_xslx'> </div>
	{% if dropdown_config %}
		<div id='{{view_name}}_{{button_name}}_open_btn_div'>
			<div id='{{view_name}}_{{button_name}}_open_split_btn'>
				<div id='{{view_name}}_{{button_name}}_button'> {{button_title}} </div>
				<div id='{{view_name}}_{{button_name}}_button_dropdown' class='dropdown_btn_xlsx'>#</div>
			</div>
			<ul id='{{view_name}}_{{button_name}}_dropdown_options' class='dropdown_opt_xlsx'>
				{% for btn in dropdown_config %}
					<li><a id="{{view_name}}_{{button_name}}_{{btn.name}}_button" href='#' class='submit'> {{btn.title}} </a></li>
				{% endfor %}
			</ul>
		</div>
	{% else %}
		<div id='{{view_name}}_{{button_name}}_button'> {{button_title}} </div>
	{% endif %}
</div>

<!-- <div id="{{view_name}}_div_excel_csv" class="excel_container">
	<a id = "excel_{{view_name}}" href="#"  alt="{% trans 'Save CDRs whith current settings' %}">Excel</a>
	<a id="csv_{{view_name}}" href="#"  alt="{% trans 'Save CDRs whith current settings' %}">CSV</a>
</div> -->


<script type="text/javascript" lang="text/javascript">

	$('#{{view_name}}_{{button_name}}_button').button({icons: {primary: "ui-icon-disk"}});
	$('#{{view_name}}_{{button_name}}_button_dropdown').button({text: false, icons: {primary: "ui-icon-triangle-1-s"}});
	$('#{{view_name}}_{{button_name}}_button_dropdown').attr('title', null);
	$('#{{view_name}}_{{button_name}}_open_split_btn').buttonset().next().hide().menu();

	$('#{{view_name}}_{{button_name}}_button').click(function(e){
		var button_name = '{{button_name}}';
		{{view_name}}_callback('xlsx',button_name);
	});

	// Dropdown flow
	$('#{{view_name}}_{{button_name}}_button_dropdown').click(function(e){
		if($(this).parent().next().is(':visible')){
			$(this).parent().next().hide();
		} else{
			$('.dropdown_opt_xlsx').hide();
			var menu = $(this).parent().next().show().position({
				my: "right top",
				at: "right bottom",
				of: this
			});
			$('#{{view_name}}_container').one( "click", function() {
				menu.hide();
			});
			return false;
		}
	});

	// Dropdown options functionality
	{% for btn in dropdown_config %}
		$('#{{view_name}}_{{button_name}}_{{btn.name}}_button').click(function(){
			{{view_name}}_callback('xlsx', '{{button_name}}', '{{btn.name}}');
		});
	{% endfor %}

	function setExportFile(URL_XLSX,param){

			MEDIA_URL='/media/'


			url = URL_XLSX
			$.ajax({
				type: 'GET',
				url: url+'?'+param,
				dataType: 'json',
				success: function(response){
					// console.log('returned...',response);
					url_icon = '</span><a href="'+MEDIA_URL+response['file_url']+'" title=""><span class="ui-icon ui-icon-circle-arrow-s download_file"  id = "{{view_name}}_{{button_name}}_button_download" s></span></a></span></div>'
					createMessagesLocal('{{view_name}}_result_messages',"{% trans 'Generating excel ... ' %}", 'info', 3000);
			
					$('#{{view_name}}_{{button_name}}_download').html(url_icon);
					$('#{{view_name}}_{{button_name}}_button_download').click();
					$('#{{view_name}}_{{button_name}}_button_download').hide();

					// setCloseMessagesEvent();
				}
			});
		};

function saveFile(url,param)
{
	error = false;
	$.fileDownload(url, {
		data: param,
	    failCallback: function () {
	 		error = true
	 		createMessagesLocal('{{view_name}}_result_messages',"{% trans 'There was a problem generating your report, please try again.' %}", 'error', 3000);	
	    },
	});

	if (error == false){
		createMessagesLocal('{{view_name}}_result_messages',"{% trans 'We are preparing your report, please wait...' %}", 'success', 3000);	
	}
}




function {{view_name}}_totalRow(name_grid)
{

	name_grid = '#'+name_grid+'_grid_pager_right'

	grid_pager = $(name_grid).html()

	from_substring = grid_pager.indexOf('of')

	to_substring= grid_pager.indexOf('</div')

	total_row =grid_pager.substring(parseInt(from_substring)+3,parseInt(to_substring))

	total_row = total_row.replace(',','')
	total_row = total_row.replace(',','')

	total_row = parseInt(total_row)

	return total_row
}


</script> 