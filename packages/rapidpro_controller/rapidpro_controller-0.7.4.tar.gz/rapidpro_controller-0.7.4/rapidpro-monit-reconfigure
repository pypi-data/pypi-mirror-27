#!/usr/bin/env python
# -*- coding: utf-8 -*-
# vim: ai ts=4 sts=4 et sw=4 nu

from __future__ import (unicode_literals, absolute_import,
                        division, print_function)
import sys
import os


from rapidpro_controller import (get_logger, log_success, log_failure)
from rapidpro_controller.services import reconfigure_monit

logger = get_logger(os.path.basename(__file__))


def usage():
    logger.error("Usage: {} [enable|disable]".format(sys.argv[0]))
    return 1


def main(args):
    if not len(args):
        return usage()

    monit_mode = args[0].strip().lower()
    if monit_mode not in ('enable', 'disable'):
        return usage()

    logger.info("reconfiguring monit to `{}`.".format(monit_mode))
    if reconfigure_monit(monit_mode == 'enable', auto_reload=True):
        log_success(logger)
    else:
        log_failure(logger)
        return 1
    return 0


if __name__ == '__main__':
    sys.exit(main(sys.argv[1:]))
